(function(g){var window=this;'use strict';var uv9=function(x){var u=new g.mu("und",new g.hh("Default","und",!0));u.captionTracks=x.captionTracks;return u},g5S=function(x){return new g.wX(function(u,k){var U=x.length,m=[];
if(U)for(var F=function(X,q){U--;m[X]=q;U==0&&u(m)},f=function(X){k(X)},V,h=0;h<x.length;h++)V=x[h],g.de5(V,g.o$(F,h),f);
else u(m)})},Z3=function(x){this.S=x},a8=function(){Z3.apply(this,arguments)},kcS=function(){a8.apply(this,arguments)},UyW=function(){a8.apply(this,arguments)},my9=function(){a8.apply(this,arguments)},FPk=function(){a8.apply(this,arguments)},fjS=function(){a8.apply(this,arguments)},bp9=function(){a8.apply(this,arguments)},VQk=function(){Z3.apply(this,arguments)},hHm=function(){a8.apply(this,arguments)},XLm=function(){a8.apply(this,arguments)},quG=function(){a8.apply(this,arguments)},sZZ=function(){a8.apply(this,
arguments)},Hpt=function(){a8.apply(this,arguments)},RHt=function(){a8.apply(this,arguments)},pLG=function(){a8.apply(this,arguments)},cVs=function(){a8.apply(this,arguments)},MQo=function(){a8.apply(this,arguments)},wLB=function(){a8.apply(this,arguments)},yVm=function(){a8.apply(this,arguments)},YuS=function(){a8.apply(this,arguments)},tQt=function(){Z3.apply(this,arguments)},E5B=function(){a8.apply(this,arguments)},Gc$=function(){a8.apply(this,arguments)},zHt=function(){a8.apply(this,arguments)},
WP$=function(){a8.apply(this,arguments)},Opt=function(){a8.apply(this,arguments)},ips=function(){a8.apply(this,arguments)},ljS=function(){a8.apply(this,arguments)},n5G=function(){a8.apply(this,arguments)},$ym=function(){a8.apply(this,arguments)},rVo=function(){Z3.apply(this,arguments)},jZG=function(){Z3.apply(this,arguments)},Zpm=function(){Z3.apply(this,arguments)},aj9=function(){a8.apply(this,arguments)},QZS=function(){a8.apply(this,arguments)},Ijt=function(){a8.apply(this,arguments)},eHS=function(){a8.apply(this,
arguments)},JVo=function(){a8.apply(this,arguments)},PQs=function(){a8.apply(this,arguments)},NLm=function(){a8.apply(this,arguments)},dyt=function(){a8.apply(this,arguments)},KPo=function(){a8.apply(this,arguments)},v5t=function(){a8.apply(this,arguments)},TLo=function(){a8.apply(this,arguments)},AVW=function(){a8.apply(this,arguments)},CQ$=function(){a8.apply(this,arguments)},LPk=function(){a8.apply(this,arguments)},Dyt=function(){a8.apply(this,arguments)},SuZ=function(){a8.apply(this,arguments)},
BLk=function(){a8.apply(this,arguments)},oL$=function(){a8.apply(this,arguments)},xxG=function(){a8.apply(this,arguments)},uzZ=function(){a8.apply(this,arguments)},gLk=function(){a8.apply(this,arguments)},kio=function(){a8.apply(this,arguments)},UxG=function(){a8.apply(this,arguments)},mxG=function(){a8.apply(this,arguments)},FeZ=function(){a8.apply(this,arguments)},fCo=function(){a8.apply(this,arguments)},blk=function(){Z3.apply(this,arguments)},V0B=function(){a8.apply(this,arguments)},h_Z=function(){a8.apply(this,
arguments)},XUm=function(){a8.apply(this,arguments)},qet=function(){a8.apply(this,arguments)},sat=function(){a8.apply(this,arguments)},Hl$=function(){a8.apply(this,arguments)},R_9=function(){a8.apply(this,arguments)},pUG=function(){a8.apply(this,arguments)},cIG=function(){a8.apply(this,arguments)},M0G=function(){a8.apply(this,arguments)},wU9=function(){a8.apply(this,arguments)},yIs=function(){a8.apply(this,arguments)},Yet=function(){a8.apply(this,arguments)},t0m=function(){a8.apply(this,arguments)},
ELS=function(){a8.apply(this,arguments)},Gi9=function(){a8.apply(this,arguments)},z_m=function(){a8.apply(this,arguments)},WeG=function(){a8.apply(this,arguments)},Ol9=function(){a8.apply(this,arguments)},ilt=function(){a8.apply(this,arguments)},lCB=function(){a8.apply(this,arguments)},nLt=function(){a8.apply(this,arguments)},$xS=function(){a8.apply(this,arguments)},rIG=function(){a8.apply(this,arguments)},jaG=function(){a8.apply(this,arguments)},Zlt=function(){a8.apply(this,arguments)},aCG=function(){a8.apply(this,
arguments)},QaZ=function(){a8.apply(this,arguments)},ICS=function(){a8.apply(this,arguments)},e_o=function(){a8.apply(this,arguments)},JIW=function(){a8.apply(this,arguments)},PDt=function(x){x=x.key||x.id;
if(!x)throw Error("Entity key is missing");return x},Nnt=function(){if(QE)return QE();
var x={};QE=g.FT("PersistentEntityStoreDb",{mw:(x.EntityStore={EU:1},x.EntityAssociationStore={EU:2},x),shared:!1,upgrade:function(u,k){k(1)&&g.NW(g.aV(u,"EntityStore",{keyPath:"key"}),"entityType","entityType");k(2)&&(u=g.aV(u,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.NW(u,"byParentEntityKey","parentEntityKey"),g.NW(u,"byChildEntityKey","childEntityKey"))},
version:3});return QE()},dxt=function(x){return g.Do(Nnt(),x)},Ke$=function(x){return g.Do((0,g.Zcs)(),x)},I8=function(x){this.token=x},eY=function(x,u){u=u===void 0?{}:u;
g.BG.call(this,g.atm[x],Object.assign({},{name:"PESEncoderError",type:x},u));this.type=x;this.level="WARNING";Object.setPrototypeOf(this,eY.prototype)},vLm=function(x){return new eY("WRONG_DATA_TYPE",{XV:x})},Tnt=function(x){return x instanceof Error?new eY("UNKNOWN_ENCODE_ERROR",{Oo:x.message}):new eY("UNKNOWN_ENCODE_ERROR")},AI9=function(x){return x instanceof Error?new eY("UNKNOWN_DECODE_ERROR",{Oo:x.message}):new eY("UNKNOWN_DECODE_ERROR")},CDs=function(x,u){x=x instanceof eY?x:u(x);
g.Pc(x);throw x;},LeB=function(){},Dxm=function(x,u,k){try{return x.J(u,k)}catch(U){CDs(U,Tnt)}},SeG=function(x){x=(new TextEncoder).encode(x).subarray(0,16);
var u=new Uint8Array(16);u.set(x);return u},J4=function(x){this.S=x},oSS=function(x){var u=Bnw[x];
if(u)return u;g.Nz(new g.BG("Entity model not found.",{entityType:x}))},x4G=function(x,u){this.S=x;
this.V=u;this.J={}},gSo=function(x,u){a:{x=uXW(x.V,u.version);
try{var k=x.V(u.data,u.key);break a}catch(U){CDs(U,AI9)}k=void 0}return k},Px=function(x,u,k){return x.S.objectStore("EntityStore").get(u).then(function(U){if(U){if(k&&U.entityType!==k)throw Error("Incorrect entity type");
return gSo(x,U)}})},NZ=function(x,u,k){return k?(k=k.map(function(U){return Px(x,U,u)}),g.l3.all(k)):x.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(u)).then(function(U){return U.map(function(m){return gSo(x,m)})})},Ks=function(x,u,k){var U=PDt(u),m=uXW(x.V,1),F=Object.assign({},u);
return x.S.objectStore("EntityStore").get(U).then(function(f){if(f){if(f.entityType!==k)throw Error("Incorrect entity type");F.entityMetadata||(f=gSo(x,f),F.entityMetadata=f.entityMetadata)}}).then(function(){var f={key:U,
entityType:k,data:Dxm(m,F,U),version:1};return g.l3.all([g.e4(x.S.objectStore("EntityStore"),f),kv9(x,F,k)])}).then(function(){d1(x,U,k);
return U})},U4Z=function(x,u,k){u=u.map(function(U){return Ks(x,U,k)});
return g.l3.all(u)},vx=function(x,u,k){if(k==null?0:k.IL){var U=new Set;
return m4k(x,u,U).then(function(){for(var F=[],f=g.w(U),V=f.next();!V.done;V=f.next())F.push(vx(x,V.value));return g.l3.all(F).then(function(){})})}var m=g.sA(u).entityType;
return g.l3.all([x.S.objectStore("EntityStore").delete(u),FMo(x,u)]).then(function(){d1(x,u,m)})},fko=function(x,u){return g.TZ(x.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(u)},function(k){return g.l3.all([k.delete(),
FMo(x,k.cursor.primaryKey)]).then(function(){d1(x,k.cursor.primaryKey,u);return g.KG(k)})})},bqB=function(x,u,k,U){var m=uXW(x.V,1);
return Px(x,u,U).then(function(F){if(F){F=g.EH(F,k);var f={key:u,entityType:U,data:Dxm(m,F,u),version:1};return g.l3.all([g.e4(x.S.objectStore("EntityStore"),f),kv9(x,F,U)])}}).then(function(){d1(x,u,U);
return u})},d1=function(x,u,k){var U=x.J[k];
U||(U=new Set,x.J[k]=U);U.add(u)},VOs=function(x,u,k){var U=PDt(u);
k=oSS(k);if(!k)return g.l3.resolve([]);k=new k(u);x=x.S.objectStore("EntityAssociationStore");u=[];k=g.w(k.V());for(var m=k.next();!m.done;m=k.next())u.push(g.e4(x,{parentEntityKey:U,childEntityKey:m.value}));return g.l3.all(u).then(function(F){return F.map(function(f){return f[1]})})},FMo=function(x,u){return x.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u))},kv9=function(x,u,k){var U=PDt(u);
return FMo(x,U).then(function(){return VOs(x,u,k)})},m4k=function(x,u,k){if(k.has(u))return g.l3.resolve(void 0);
k.add(u);return h0k(x,u).then(function(U){return x.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u)).then(function(){return U})}).then(function(U){var m=g.l3.resolve(void 0);
U=g.w(U);for(var F=U.next(),f={};!F.done;f={vz:void 0},F=U.next())f.vz=F.value,m=m.then(function(V){return function(){return m4k(x,V.vz,k)}}(f));
return m}).then(function(){})},h0k=function(x,u){var k=x.S.objectStore("EntityAssociationStore");
return k.index("byParentEntityKey").getAll(IDBKeyRange.only(u)).then(function(U){var m=[];U=g.w(U);for(var F=U.next();!F.done;F=U.next())F=F.value,m.push(k.index("byChildEntityKey").getAll(F.childEntityKey));return g.l3.all(m)}).then(function(U){var m=[];
U=g.w(U);for(var F=U.next();!F.done;F=U.next())F=F.value,F.length===1&&m.push(F[0].childEntityKey);return m})},TP=function(){},XA9=function(){this.S={};
this.S[0]=new TP;if(!g.Ww("aes_pes_encoder_killswitch")){var x=this.S;try{var u=g.oV();var k=SeG(u);var U=new J4(new g.l2(k),new g.i2(k))}catch(m){throw x=m instanceof Error?new eY("KEY_CREATION_FAILED",{Oo:m.message}):new eY("KEY_CREATION_FAILED"),g.Pc(x),x;}x[1]=U}},uXW=function(x,u){u=u===void 0?0:u;
x=x.S[u];if(!x)throw u=new eY("INVALID_ENCODER_VERSION",{XV:u}),g.Pc(u),u;return x},A4=function(x,u){g.J.call(this);
this.token=x;this.S=u;this.observers=[];x=new g.JY.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.oV());x.onmessage=this.V.bind(this);this.channel=x},Cs=function(x,u,k){var U,m,F,f;
return g.Z(function(V){if(V.S==1)return g.n(V,dxt(x.token),2);if(V.S!=3)return U=V.V,g.n(V,g.IV(U,["EntityStore","EntityAssociationStore"],u,function(h){m=new x4G(h,x.S);return k(m)}),3);
F=V.V;m&&(f=m.J,Object.keys(f).length>0&&(x.channel.postMessage(f),q1B(x,f)));return V.return(F)})},Ls=function(x,u,k){return Cs(x,{mode:"readwrite",
IU:!0},function(U){return Ks(U,u,k)})},sdt=function(x,u){return Cs(x,{mode:"readwrite",
IU:!0},function(k){return U4Z(k,u,"offlineOrchestrationActionWrapperEntity")})},HqS=function(x,u){return Cs(x,{mode:"readwrite",
IU:!0},function(k){return vx(k,u)})},R0t=function(x){return Cs(x,{mode:"readwrite",
IU:!0},function(u){return fko(u,"videoPlaybackPositionEntity")})},D3=function(x,u,k){return Cs(x,{mode:"readonly",
IU:!0},function(U){return Px(U,u,k)})},SY=function(x,u,k){return Cs(x,{mode:"readonly",
IU:!0},function(U){return NZ(U,u,k)})},q1B=function(x,u){x=g.w(x.observers);
for(var k=x.next();!k.done;k=x.next())k=k.value,k(u)},pAm=function(){var x,u,k;
return g.Z(function(U){if(U.S==1)return g.YI(U,2),g.n(U,g.UJ(),4);if(U.S!=2){x=U.V;if(!x||!g.xs()||typeof g.JY.BroadcastChannel==="undefined")return U.return();u=new XA9;return U.return(new A4(x,u))}k=g.Gx(U);k instanceof Error&&g.Pc(k);return U.return()})},Bx=function(){cRW||(cRW=pAm());
return cRW},MOt=function(x){var u;
x=(u=x.options)==null?void 0:u.persistenceOption;return x==="ENTITY_PERSISTENCE_OPTION_PERSIST"||x==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},wAt=function(x){var u;
return g.Z(function(k){return k.S==1?g.n(k,Bx(),2):(u=k.V)?g.n(k,Cs(u,"readwrite",function(U){for(var m={},F=g.w(x),f=F.next(),V={};!f.done;V={wk:void 0,wp:void 0},f=F.next())V.wk=f.value,V.wk.entityKey&&MOt(V.wk)&&(V.wp=g.z4(V.wk.payload),f=void 0,V.wk.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(f=function(h){return function(){return Ks(U,h.wk.payload[h.wp],h.wp)}}(V)),V.wk.type==="ENTITY_MUTATION_TYPE_DELETE"&&(f=function(h){return function(){return vx(U,h.wk.entityKey)}}(V)),V.wk.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(f=function(h){return function(){return bqB(U,h.wk.entityKey,h.wk.payload[h.wp],h.wp)}}(V)),f&&(m[V.wk.entityKey]=m[V.wk.entityKey]?m[V.wk.entityKey].then(f):f()));
return g.l3.all(Object.values(m))}),0):k.return()})},yRG=function(x){var u;
return g.Z(function(k){if(k.S==1){u=x.mutations;if(!u||u.length<=0)return k.return();if(g.k8){var U={type:"ENTITY_LOADED"};u!==void 0&&(U.payload=u);g.k8.dispatch(U)}return g.n(k,wAt(u),2)}u.length=0;g.wQ(k)})},Y1B=function(x){return x!==void 0},tOk=function(x){var u=g.nO();
u=Object.assign({},u);x=Object.assign({},x);for(var k in u)x[k]?(u[k]!==4&&(u[k]=x[k]),delete x[k]):u[k]!==2&&(u[k]=4);Object.assign(u,x);g.Dc$(u);JSON.stringify(u);return u},ESG=function(x){var u,k;
return g.Z(function(U){if(U.S==1)return g.n(U,g.UJ(),2);if(U.S!=3)return(u=U.V)?g.n(U,g.jI(u),3):U.return();k=U.V;return U.return(g.IV(k,["index","media","captions"],{mode:"readwrite",IU:!0},function(m){var F=IDBKeyRange.bound(x+"|",x+"~");m=[m.objectStore("index").delete(F),m.objectStore("media").delete(F),m.objectStore("captions").delete(F)];return g.l3.all(m).then(function(){})}))})},GvB=function(){var x,u;
return g.Z(function(k){if(k.S==1)return g.n(k,g.UJ(),2);if(k.S!=3){x=k.V;if(!x)throw g.Ow("rvdfd");return g.n(k,g.jI(x),3)}u=k.V;return k.return(g.IV(u,["index","media"],{mode:"readwrite",IU:!0},function(U){var m={};return g.dB(U.objectStore("index"),{},function(F){var f=F.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),V=g.l3.resolve(void 0);if(f){var h=f[1];f=f[2];m[h]=m[h]||{};var X;m[h][f]=g.uVQ((X=F.getValue())==null?void 0:X.fmts)}else V=F.delete().then(function(){});
return g.l3.all([g.KG(F),V]).then(function(q){return g.w(q).next().value})}).then(function(){for(var F={},f=g.w(Object.keys(m)),V=f.next();!V.done;V=f.next()){V=V.value;
var h=m[V].v;F[V]=m[V].a&&h?1:2}var X=tOk(F);return g.nyY(U.objectStore("media"),{},function(q){var H=q.cursor.key.match(g.mjR);H&&F[H[1]]||U.objectStore("media").delete(q.cursor.key);return g.YVk(q)}).then(function(){return X})})}))})},z0t=function(x,u){var k,U;
return g.Z(function(m){if(m.S==1)return g.n(m,g.UJ(),2);if(m.S!=3){k=m.V;if(!k)throw g.Ow("wct");return g.n(m,g.jI(k),3)}U=m.V;return g.n(m,g.IV(U,["captions"],{mode:"readwrite",IU:!0},function(F){var f=[];F=F.objectStore("captions");for(var V=0;V<u.length;V++){var h=g.e4(F,u[V],x+"|"+u[V].metadata.vss_id);f.push(h)}return g.l3.all(f)}),0)})},WMk=function(x){var u,k,U;
return g.Z(function(m){if(m.S==1)return u=IDBKeyRange.bound(x+"|",x+"~"),g.n(m,g.UJ(),2);if(m.S!=3){k=m.V;if(!k)throw g.Ow("gactfv");return g.n(m,g.jI(k),3)}U=m.V;return m.return(U.getAll("captions",u))})},OqZ=function(x){return g.Z(function(u){g.ri(x,0);
return u.return(ESG(x))})},iqm=function(x){return{context:g.kl(),
videoIds:x}},lkw=function(x){return{context:g.kl(),
playlistIds:x}},nSs=function(x){return{context:g.kl(),
offlinePlaylistSyncChecks:x}},$4t=function(){this.S=new Map},jdZ=function(){rRt||(rRt=new $4t);
return rRt},Zqm=function(x,u){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:x},metadata:u,statusCode:void 0,csn:void 0,can:void 0}},aks=function(x,u,k){if(!k){var U=U===void 0?!1:U;
k=x.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!k||U)k=g.lu(16),x.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",k)}x={flowNonce:k,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:u.eventType};u.metadata&&(x.flowMetadata=u.metadata);u.statusCode!==void 0&&(x.flowEventStatus=u.statusCode);u.csn&&(x.csn=u.csn);u.can&&(x.can=u.can);g.RV("flowEvent",x,void 0)},Qdm=function(x){var u,k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l;
return g.Z(function(a){if(a.S==1)return g.n(a,Cs(x,{mode:"readonly",IU:!0},function(e){return NZ(e,"playbackData").then(function(xI){var UY=xI.map(function(pR){return pR.transfer}).filter(function(pR){return!!pR}),mk=xI.map(function(pR){return pR.offlineVideoPolicy}).filter(function(pR){return!!pR}),Q=xI.filter(function(pR){return!!pR.key}).map(function(pR){return g.H_(g.sA(pR.key).entityId,"downloadStatusEntity")});
UY=NZ(e,"transfer",UY);mk=NZ(e,"offlineVideoPolicy",mk);Q=NZ(e,"downloadStatusEntity",Q);var hY=UY.then(function(pR){pR=pR.reduce(function(b5,$I){($I==null?0:$I.offlineVideoStreams)&&b5.push.apply(b5,g.t($I.offlineVideoStreams));return b5},[]).filter(function(b5){return!!b5});
return NZ(e,"offlineVideoStreams",pR)});
return g.l3.all([UY,mk,hY,Q]).then(function(pR){var b5=g.w(pR);pR=b5.next().value;var $I=b5.next().value;var Hk=b5.next().value;b5=b5.next().value;return[xI,pR,$I,Hk,b5]})})}),2);
if(a.S!=3)return u=a.V,g.n(a,Cs(x,{mode:"readonly",IU:!0},function(e){return NZ(e,"mainDownloadsListEntity").then(function(xI){var UY,mk;return(mk=(UY=xI[0])==null?void 0:UY.downloads)!=null?mk:[]})}),3);
k=a.V;U=g.w(u);m=U.next().value;F=U.next().value;f=U.next().value;V=U.next().value;h=U.next().value;X=m;q=F;H=f;R=V;p=h;c={};Y={};E={};z={};O={};r=[];I=g.w(q);for(N=I.next();!N.done;N=I.next())(L=N.value)&&(c[L.key]=L);C=g.w(H);for(kI=C.next();!kI.done;kI=C.next())(Fj=kI.value)&&(Y[Fj.key]=Fj);ob=g.w(p);for(K=ob.next();!K.done;K=ob.next())(B=K.value)&&(E[B.key]=B);y=g.w(R);for(v=y.next();!v.done;v=y.next())(P4=v.value)&&(z[P4.key]=P4);Yw=g.w(k);for(so=Yw.next();!so.done;so=Yw.next())OY=so.value,SW=
void 0,O[(SW=OY.videoItem)!=null?SW:""]=!0,OY.videoItem&&(pm=mm=void 0,G=(pm=(mm=g.sA(OY.videoItem))==null?void 0:mm.entityId)!=null?pm:"",r.push({externalVideoId:G}));W=X.filter(function(e){if(!e||!e.key||!e.offlineVideoPolicy)return!1;e=g.sA(e.key).entityId;e=g.H_(e,"downloadStatusEntity");var xI;return!(e&&((xI=E[e])==null?void 0:xI.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
l=W.map(function(e){var xI=c[e.transfer],UY=[];if(xI==null?0:xI.offlineVideoStreams)for(var mk=g.w(xI.offlineVideoStreams),Q=mk.next();!Q.done;Q=mk.next())(Q=z[Q.value])&&UY.push(Q);mk=Y[e.offlineVideoPolicy];Q=O;var hY=e==null?void 0:e.playerResponseTimestamp,pR=g.sA(mk.key).entityId;e=g.H_(pR,"mainVideoEntity");if(mk.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var b5="OFFLINE_VIDEO_STATE_DISABLED";mk.expirationTimestamp&&Number(mk.expirationTimestamp)<Date.now()/1E3&&(b5="OFFLINE_VIDEO_STATE_EXPIRED")}else if(mk.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")b5="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(xI==null?void 0:xI.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":b5="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":b5="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":b5="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":b5="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":b5="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":b5="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:b5="OFFLINE_VIDEO_STATE_UNKNOWN"}if(b5==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(xI==null?void 0:xI.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":b5="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":b5="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":b5=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}pR={id:pR,videoState:b5};if(xI==null?0:xI.cotn)pR.cotn=xI.cotn;if(xI==null?0:xI.maximumDownloadQuality)pR.selectedVideoQuality=xI==null?void 0:xI.maximumDownloadQuality;if(xI==null?0:xI.lastProgressTimeMs)pR.lastProgressTimeMs=xI.lastProgressTimeMs;hY&&(pR.playerResponseSavedTimeMs=String(Number(hY)*1E3));xI=String;hY=0;UY=g.w(UY);for(b5=UY.next();!b5.done;b5=UY.next())if(b5=b5.value,b5.streamsProgress){b5=g.w(b5.streamsProgress);for(var $I=b5.next();!$I.done;$I=
b5.next()){var Hk=void 0;hY+=Number((Hk=$I.value.numBytesDownloaded)!=null?Hk:0)}}pR.downloadedBytes=xI(hY);pR.selectedOfflineMode=Q[e]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";mk.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(pR.offlinePlaybackDisabledReason=mk.offlinePlaybackDisabledReason);return pR});
return a.return({offlineVideos:l,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:r}}})})},Ikw=function(){this.locks=navigator.locks},e0$=function(){try{var x=g.dQ("ytglobal.locks_");
if(x)return x;var u;if(u=navigator){var k=navigator;u="locks"in k&&!!k.locks}if(u)return g.JY.localStorage&&g.JY.localStorage.getItem("noop"),x=new Ikw,g.ND("ytglobal.locks_",x),x}catch(U){}},oH=function(){},JRG=function(){},PMG=function(x){if(x.includes(":"))throw Error("Invalid user cache name: "+x);
return x+":"+g.oV("CacheStorage get")},N4S=function(){return g.Z(function(x){if(x_!==void 0)return x.return(x_);
x_=new Promise(function(u){var k;return g.Z(function(U){switch(U.S){case 1:return g.YI(U,2),g.n(U,uv.open("test-only"),4);case 4:return g.n(U,uv.delete("test-only"),5);case 5:g.EY(U,3);break;case 2:if(k=g.Gx(U),k instanceof Error&&k.name==="SecurityError")return u(!1),U.return();case 3:u("caches"in window),g.wQ(U)}})});
return x.return(x_)})},KMo=function(){return g.Z(function(x){if(x.S==1)return g.n(x,N4S(),2);
if(!x.V)return x.return(void 0);d4S||(d4S=new JRG);return x.return(d4S)})},gg=function(x,u,k){g.Nz(new g.BG("Woffle: "+x,k?{cotn:k}:""));
u instanceof Error&&g.Nz(u)},vSm=function(x){var u;
return g.Z(function(k){if(k.S==1)return g.n(k,Qdm(x),2);u=k.V;g.RV("offlineStateSnapshot",u);g.wQ(k)})},k_=function(x){g.J.call(this);
var u=this;this.api=x;this.nN={AVY:function(){return u.S},
FwJ:function(){return u.V}};
typeof g.JY.BroadcastChannel!=="undefined"&&(this.S=new g.JY.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.oV()),this.S.onmessage=this.J.bind(this),this.V=new g.JY.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.oV()),this.V.onmessage=this.K.bind(this))},Uz=function(x,u){x.api.Xt("onOfflineOperationFailure",u);
var k;(k=x.S)==null||k.postMessage(u)},T4w=function(x,u,k,U){var m=this;
this.B=x;this.U=u;this.visibility=k;this.G=U;this.N=this.D=this.j=this.J=this.S=!1;this.K=new g.gl(function(){m.w4()});
this.nN={yB:function(){return m.V},
w4:function(){m.w4()},
E8Y:function(){return m.K}};
this.visibility.subscribe("visibilitystatechange",function(){m.VQ()})},AR9=function(x){if(!x.J&&!x.S){var u=e0$();
if(u){x.J=!0;var k=g.oV("OfflineLockManager");u.request("woffle_orchestration_leader:"+k,{},function(){var U,m,F,f;return g.Z(function(V){switch(V.S){case 1:return g.YI(V,2),x.V=new g.wJ,x.S=!0,x.J=!1,g.n(V,x.B(),4);case 4:return g.n(V,x.V.promise,5);case 5:g.EY(V,0);break;case 2:U=g.Gx(V),((F=(m=x).G)==null?0:F.call(m,"wo_relinquish_leadership_on_lock_request_error"))||x.w4(),U instanceof Error&&(f=U,f.args=[{name:"WoLockManagerError",O4:U.name}],g.Pc(f)),g.wQ(V)}})})}}},CMZ=function(x){x.S&&(x.N=
!0,mK(x))},LMo=function(x,u){x.S&&(x.j=u,mK(x))},D4t=function(x,u){x.S&&(x.D=u,mK(x))},mK=function(x){x.D&&x.j&&x.N&&x.visibility.isBackground()?g.ky(x.K,6E4):x.K.stop()},F1=function(x){var u;
x.offlineDeleteReason=(u=x.offlineDeleteReason)!=null?u:"OFFLINE_DELETE_REASON_UNKNOWN";var k;x.offlineModeType=(k=x.offlineModeType)!=null?k:"OFFLINE_NOW";g.RV("offlineDeleteEvent",x)},f9=function(x,u){var k=u.videoId;
var U=u.Jg;u=u.offlineModeType;x.encryptedVideoId=k;x.cotn=U==null?void 0:U.cotn;x.offlineabilityFormatType=U==null?void 0:U.maximumDownloadQuality;var m;x.isRefresh=(m=U==null?void 0:U.isRefresh)!=null?m:!1;var F;x.softErrorCount=(F=U==null?void 0:U.transferRetryCount)!=null?F:0;x.offlineModeType=u!=null?u:"OFFLINE_NOW";(x.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&x.statusType==="UNKNOWN_STATUS_TYPE"||!x.transferStatusType&&!x.statusType)&&g.Nz(Error("Woffle unknown transfer status"));
g.RV("offlineTransferStatusChanged",x)},S19=function(x,u,k,U){U={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!U};u&&k&&(u=Math.floor(u/1024).toFixed(),k=Math.floor(k/1024).toFixed(),U.alreadyDownloadedKbytes=u,U.totalFetchedKbytes=u,U.totalContentKbytes=k);f9(U,x)},B4B=function(x){f9({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},x)},o0t=function(x){switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
bv=function(x){var u,k,U;
return((U=(u=x.actionMetadata)==null?void 0:(k=u.retryScheduleIntervalsInSeconds)==null?void 0:k.length)!=null?U:0)>0},Vn=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!x.entityKey},ho=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!x.entityKey},X1=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!x.entityKey},xCZ=function(x){return x.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!x.entityKey},
qR=function(x,u,k,U,m){m=m===void 0?!1:m;
var F,f,V,h,X,q;return g.Z(function(H){if(H.S==1)return F=g.H_(x,u),f=g.H_(x,"downloadStatusEntity"),g.n(H,Cs(k,{mode:"readonly",IU:!0},function(R){return g.l3.all([Px(R,F,u),Px(R,f,"downloadStatusEntity")])}),2);
V=H.V;h=V.length?V[0]:void 0;if(!h)return H.TY(0);X=uuW;if(q=V.length>1?V[1]:void 0){if(q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!m)return H.return();q.downloadState=U}else q={key:f,downloadState:U};g.AQ(h,X,q);return g.n(H,Cs(k,{mode:"readwrite",IU:!0},function(R){return g.l3.all([Ks(R,h,u),Ks(R,q,"downloadStatusEntity")])}),0)})},sz=function(x,u){return x.actionType===u.actionType&&x.entityKey===u.entityKey},H6=function(x,u){if(x&&x.transferState!=="TRANSFER_STATE_COMPLETE"&&x.transferState!==
"TRANSFER_STATE_FAILED"){var k=g.sA(x.key).entityId;
f9({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:k,Jg:x,offlineModeType:u})}},RH=function(x){if(!x||!x.thumbnails)return[];
var u=[];x=g.w(x.thumbnails);for(var k=x.next();!k.done;k=x.next())k=k.value,k.url&&u.push(k.url);return u},g0S=function(x,u,k){k=k===void 0?[]:k;
var U,m,F,f,V,h,X,q,H,R,p,c,Y;return g.Z(function(E){if(E.S==1)return k.length?g.n(E,SY(x,u),2):E.return([]);U=E.V;m=new Set;F=g.w(U);for(f=F.next();!f.done;f=F.next())if(V=f.value,h=V.id||V.key)X=g.sA(h).entityId,m.add(X);q=[];H=g.w(k);for(R=H.next();!R.done;R=H.next())p=R.value,c=p.offlineVideoData,Y=void 0,((Y=c)==null?0:Y.videoId)&&!m.has(c.videoId)&&q.push(p);return E.return(q)})},k3s=function(x,u,k){return new g.TU(x,{cotn:u,
raw_player_response:k,download_media:!0,start:Infinity,disable_watch_next:!0})},UCm=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},p9=function(x,u,k,U,m,F,f,V,h,X,q){this.entityType=x;
this.actionId=u;this.action=k;this.parentActionId=U;this.rootActionId=m===void 0?u:m;this.childActionIds=F;this.prereqActionId=f;this.postreqActionIds=V;this.hasChildActionFailed=X;this.retryScheduleIndex=0;this.S=q||Date.now();this.retryScheduleIndex=h||0},c6=function(x){if(!x.key)throw Error("Entity key is required.");
if(!x.actionProto)throw Error("OfflineOrchestrationAction is required.");var u=g.sA(x.key),k=g.sA(x.actionProto.entityKey);return new p9(k.entityType,u.entityId,x.actionProto,x.parentActionId,x.rootActionId,x.childActionIds,x.prereqActionId,x.postreqActionIds,x.retryScheduleIndex,x.hasChildActionFailed,Number(x.enqueueTimeSec)*1E3)},MR=function(x){return{key:g.H_(x.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:x.action,parentActionId:x.parentActionId,rootActionId:x.rootActionId,childActionIds:x.childActionIds,prereqActionId:x.prereqActionId,postreqActionIds:x.postreqActionIds,retryScheduleIndex:x.retryScheduleIndex,hasChildActionFailed:x.hasChildActionFailed,enqueueTimeSec:(x.S/1E3).toFixed()}},mCt=function(){var x;
return g.Z(function(u){return u.S==1?g.n(u,KMo(),2):(x=u.V)?u.return(x.delete("yt-player-local-img")):u.return(!0)})},wg=function(x){var u,k;
return g.Z(function(U){if(U.S==1)return g.n(U,KMo(),2);if(U.S!=3){u=U.V;if(!u)throw Error("Cache API not supported");return x.length?g.n(U,u.open("yt-player-local-img"),3):U.return()}k=U.V;return g.n(U,Promise.all(x.map(function(m){return k.delete(m)})),0)})},yn=function(x){var u,k;
return g.Z(function(U){if(U.S==1)return g.n(U,KMo(),2);if(U.S!=3){u=U.V;if(!u)throw Error("Cache API not supported");return x.length?g.n(U,u.open("yt-player-local-img"),3):U.return()}k=U.V;return g.n(U,k.addAll(x),0)})},Y_=function(x,u,k,U,m){var F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW;
return g.Z(function(mm){switch(mm.S){case 1:return F=g.H_(x,"mainVideoEntity"),f=g.H_(x,"ytMainChannelEntity"),V=g.H_(x,"transfer"),h=g.H_(x,"videoDownloadContextEntity"),g.n(mm,Cs(u,{mode:"readonly",IU:!0},function(pm){return g.l3.all([Px(pm,F,"mainVideoEntity"),Px(pm,f,"ytMainChannelEntity"),Px(pm,V,"transfer"),Px(pm,h,"videoDownloadContextEntity"),NZ(pm,"ytMainChannelEntity"),NZ(pm,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=mm.V;q=g.w(X);H=q.next().value;R=q.next().value;p=q.next().value;c=q.next().value;Y=q.next().value;E=q.next().value;z=H;O=R;r=p;I=c;N=Y;L=E;if(!z&&!O){mm.TY(3);break}C=z?RH(z.thumbnail):[];if(!O){kI=[];mm.TY(4);break}return g.n(mm,Fnk(O,N),5);case 5:kI=mm.V;case 4:return Fj=kI,g.n(mm,wg(C.concat(Fj)),3);case 3:ob=[];K=g.H_(x,"downloadStatusEntity");B=g.w(L);for(y=B.next();!y.done;y=B.next())v=y.value,P4=g.sA(v.key).entityId,Yw=c6(v),so=g.sA(Yw.action.entityKey).entityId,P4!==x&&so!==x||sz(k,
v.actionProto)||ob.push(v.key);return g.n(mm,Cs(u,{mode:"readwrite",IU:!0},function(pm){var G=ob.map(function(W){return vx(pm,W)});
G.push(vx(pm,F,{IL:!0}));G.push(vx(pm,K,{IL:!0}));return g.l3.all(G)}),7);
case 7:SW=(OY=I)==null?void 0:OY.offlineModeType,m&&(F1(m),m.offlineModeType&&(SW=m.offlineModeType)),H6(r,SW),Uz(U,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.wQ(mm)}})},Vrm=function(x,u,k,U){var m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l,a,e,xI,UY,mk,Q,hY,pR,b5,$I,Hk,eB,sC;
return g.Z(function(v4){switch(v4.S){case 1:return m=g.H_(x,"mainPlaylistEntity"),F=g.H_(x,"ytMainChannelEntity"),g.n(v4,Cs(u,{mode:"readonly",IU:!0},function(J3){return g.l3.all([Px(J3,m,"mainPlaylistEntity"),Px(J3,F,"ytMainChannelEntity"),NZ(J3,"mainPlaylistEntity"),NZ(J3,"mainDownloadsListEntity"),NZ(J3,"ytMainChannelEntity"),NZ(J3,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=v4.V;V=g.w(f);h=V.next().value;X=V.next().value;q=V.next().value;H=V.next().value;R=V.next().value;p=V.next().value;c=h;Y=X;E=q;z=H;O=R;r=p;if(!c&&!Y){v4.TY(3);break}I=c?fDo(c):[];if(!Y){N=[];v4.TY(4);break}return g.n(v4,Fnk(Y,O),5);case 5:N=v4.V;case 4:return L=N,g.n(v4,wg(I.concat(L)),3);case 3:C=[];kI=new Map;if(!c){v4.TY(7);break}return g.n(v4,b4m(c,E,z),8);case 8:C=v4.V;Fj=g.w(C);for(ob=Fj.next();!ob.done;ob=Fj.next())K=ob.value,kI.set(K,{videoId:K,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.n(v4,Cs(u,{mode:"readonly",IU:!0},function(J3){return g.l3.all([NZ(J3,"transfer"),NZ(J3,"videoDownloadContextEntity")])}),9);
case 9:B=v4.V;y=g.w(B);v=y.next().value;P4=y.next().value;Yw=v;so=P4;OY=g.w(Yw);for(SW=OY.next();!SW.done;SW=OY.next())mm=SW.value,pm=g.sA(mm.key).entityId,(G=kI.get(pm))&&mm&&(G.cotn=mm.cotn);W=g.w(so);for(l=W.next();!l.done;l=W.next())a=l.value,e=g.sA(a.key).entityId,(xI=kI.get(e))&&a&&(xI.offlineModeType=a.offlineModeType);case 7:UY=[];mk=g.w(r);for(Q=mk.next();!Q.done;Q=mk.next())hY=Q.value,pR=g.sA(hY.key).entityId,b5=c6(hY),pR!==x&&b5.rootActionId!==x||sz(k,hY.actionProto)||UY.push(hY.key);$I=
g.H_(x,"mainPlaylistEntity");return g.n(v4,Cs(u,{mode:"readwrite",IU:!0},function(J3){var Vp=UY.map(function(jp){return vx(J3,jp)});
Vp.push(vx(J3,$I,{IL:!0}));return g.l3.all(Vp)}),10);
case 10:if(!c){v4.TY(0);break}C.reverse();if(!C){v4.TY(0);break}Hk=g.w(C);eB=Hk.next();case 13:if(eB.done){v4.TY(0);break}sC=eB.value;return g.n(v4,Y_(sC,u,k,U,kI.get(sC)),14);case 14:eB=Hk.next(),v4.TY(13)}})},X1t=function(x,u,k,U){var m,F,f,V,h,X,q,H,R;
return g.Z(function(p){if(p.S==1)return m=g.H_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),F=new Map,g.n(p,Cs(x,{mode:"readwrite",IU:!0},function(c){var Y=NZ(c,"transfer"),E=NZ(c,"offlineOrchestrationActionWrapperEntity"),z=NZ(c,"videoDownloadContextEntity"),O=Px(c,m,"mainDownloadsListEntity");return g.l3.all([Y,E,z,O]).then(function(r){r=g.w(r);var I=r.next().value;var N=r.next().value;var L=r.next().value;var C=r.next().value;r=hyt.map(function(Fj){return fko(c,Fj)});
N=g.w(N);for(var kI=N.next();!kI.done;kI=N.next())kI=kI.value,sz(u,kI.actionProto)||r.push(vx(c,kI.key,{IL:!0}));C&&(C.downloads=[],r.push(Ks(c,C,"mainDownloadsListEntity")));if(L)for(L=g.w(L),C=L.next();!C.done;C=L.next())C=C.value,N=g.sA(C.key).entityId,N=g.H_(N,"transfer"),F.set(N,C.offlineModeType);return g.l3.all(r).then(function(){return I})})}),2);
f=p.V;V=g.w(f);for(h=V.next();!h.done;h=V.next())X=h.value,H6(X,F.get(X.key)),q=g.sA(X.key).entityId,H={videoId:q,offlineDeleteReason:U,cotn:X.cotn,offlineModeType:F.get(X.key)},F1(H),R=g.H_(q,"mainVideoEntity"),Uz(k,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(p,mCt(),0)})},fDo=function(x,u){var k=[];
if(x.thumbnailStyleData){x=g.w(x.thumbnailStyleData);for(var U=x.next();!U.done;U=x.next()){var m=void 0,F=void 0,f=void 0;k=k.concat(RH((m=U.value)==null?void 0:(F=m.value)==null?void 0:(f=F.collageThumbnail)==null?void 0:f.coverThumbnail))}}u=RH(u);return k.concat(u)},b4m=function(x,u,k){var U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj;
return g.Z(function(ob){U=[];m=new Set;if(k.length)for(F=g.w(k),f=F.next();!f.done;f=F.next())if(V=f.value,h=void 0,(h=V.downloads)==null?0:h.length)for(X=g.w(V.downloads),q=X.next();!q.done;q=X.next())H=q.value,H.videoItem&&(R=g.sA(H.videoItem).entityId,m.add(R));if(x.videos){p=g.w(x.videos);for(c=p.next();!c.done;c=p.next())Y=c.value,E=JSON.parse(g.sA(Y).entityId),E.videoId&&!m.has(E.videoId)&&U.push(E.videoId);z=g.w(u);for(O=z.next();!O.done;O=z.next())if(r=O.value,r.key!==x.key&&(I=r.videos))for(N=
g.w(I),L=N.next();!L.done;L=N.next())C=L.value,kI=JSON.parse(g.sA(C).entityId),kI.videoId&&(Fj=U.indexOf(kI.videoId),Fj!==-1&&U.splice(Fj,1))}return ob.return(U)})},Fnk=function(x,u){var k,U,m,F,f,V,h,X;
return g.Z(function(q){k=RH(x.avatar);U=g.w(u);for(m=U.next();!m.done;m=U.next())if(F=m.value,F.id!==x.id)for(f=g.w(RH(F.avatar)),V=f.next();!V.done;V=f.next())h=V.value,X=k.indexOf(h),X!==-1&&k.splice(X,1);return q.return(k)})},qZm=function(x){var u;
return g.Z(function(k){u=g.d(x.frameworkUpdates,to);return x.frameworkUpdates&&u?g.n(k,yRG(u),0):k.return()})},H4m=function(x){var u;
if((u=x.onResponseReceivedActions)!=null&&u.length){var k;x=(k=g.d(g.d(x.onResponseReceivedActions[0],sAG),g.n2o))==null?void 0:k.actions;if(x!=null&&x.length)return x}},Ryt=function(x){var u,k,U;
return g.Z(function(m){if(m.S==1)return x?g.n(m,D3(x,g.Zg,"mainDownloadsListEntity"),2):m.return([]);u=m.V;return((k=u)==null?0:(U=k.downloads)==null?0:U.length)?m.return(u.downloads.map(function(F){var f;return(f=F.videoItem)!=null?f:""})):m.return([])})},clG=function(x,u){var k;
return g.Z(function(U){return U.S==1?g.n(U,p1t(x,u),2):(k=U.V)?g.n(U,Cs(x,{mode:"readwrite",IU:!0},function(m){var F=[Ks(m,k.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];k.mainDownloadsListEntity&&F.push(Ks(m,k.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.l3.all(F)}),0):U.TY(0)})},p1t=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r;
return g.Z(function(I){if(I.S==1)return k=g.H_("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.H_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(I,Cs(x,{mode:"readonly",IU:!0},function(N){return g.l3.all([Px(N,k,"mainDownloadsLibraryEntity"),Px(N,U,"mainDownloadsListEntity")])}),2);
m=I.V;F=g.w(m);f=F.next().value;V=F.next().value;h=f;X=V;h||(h={id:k});q=g.w(u);for(H=q.next();!H.done;H=q.next())if(R=H.value,R===g.Zg){if(h.smartDownloadsList)return I.return();h.smartDownloadsList=R}else if(p=g.sA(R).entityType,c={},p==="mainPlaylistEntity"?c.playlistItem=R:p==="mainVideoEntity"&&(c.videoItem=R),!g.$G(c)){Y=void 0;if((Y=X)==null?0:Y.downloads){E=!1;z=g.w(X.downloads);for(O=z.next();!O.done;O=z.next())if(r=O.value,r.playlistItem===R||r.videoItem===R){E=!0;break}E||X.downloads.push(c)}else X=
{id:U,downloads:[c]};h.downloadsList=U}return I.return({mainDownloadsLibraryEntity:h,mainDownloadsListEntity:X})})},Mrt=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E;
return g.Z(function(z){if(z.S==1)return k=g.H_("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.H_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.n(z,Cs(x,{mode:"readonly",IU:!0},function(O){return g.l3.all([Px(O,k,"mainDownloadsLibraryEntity"),Px(O,U,"mainDownloadsListEntity"),Px(O,g.Zg,"mainDownloadsListEntity")])}),2);
m=z.V;F=g.w(m);f=F.next().value;V=F.next().value;h=F.next().value;X=f;q=V;H=h;if(!X)return z.TY(0);if(u===g.Zg&&((R=H)==null?0:R.downloads))H.downloads=[];else if((p=q)==null?0:p.downloads)for(c=g.sA(u).entityType,Y=0;Y<q.downloads.length;Y++)if(E=q.downloads[Y],c==="mainVideoEntity"&&E.videoItem===u){q.downloads.splice(Y,1);break}else if(c==="mainPlaylistEntity"&&E.playlistItem===u){q.downloads.splice(Y,1);break}return g.n(z,Cs(x,{mode:"readwrite",IU:!0},function(O){var r=[Ks(O,X,"mainDownloadsLibraryEntity")];
q&&r.push(Ks(O,q,"mainDownloadsListEntity"));H&&r.push(Ks(O,H,"mainDownloadsListEntity"));return g.l3.all(r)}),0)})},Ez=function(x,u){var k,U,m,F,f,V,h,X,q,H,R;
return g.Z(function(p){if(p.S==1)return k=g.H_(u,"transfer"),U=g.H_(u,"videoDownloadContextEntity"),g.n(p,Cs(x,{mode:"readonly",IU:!0},function(c){return g.l3.all([Px(c,k,"transfer"),Px(c,U,"videoDownloadContextEntity")])}),2);
m=p.V;F=g.w(m);f=F.next().value;V=F.next().value;h=f;X=V;R={videoId:u,cotn:(q=h)==null?void 0:q.cotn,offlineModeType:(H=X)==null?void 0:H.offlineModeType};return p.return(R)})},GG=function(x,u,k,U,m){var F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI;
return g.Z(function(Fj){switch(Fj.S){case 1:return F=g.H_(x,"musicTrack"),f=g.H_(x,"transfer"),g.n(Fj,Cs(u,{mode:"readonly",IU:!0},function(ob){return g.l3.all([Px(ob,F,"musicTrack"),Px(ob,f,"transfer"),NZ(ob,"musicTrack"),NZ(ob,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=Fj.V;h=g.w(V);X=h.next().value;q=h.next().value;H=h.next().value;R=h.next().value;p=X;c=q;Y=H;E=R;if(!p){Fj.TY(3);break}return g.n(Fj,w1m(p,Y),4);case 4:return z=Fj.V,g.n(Fj,wg(z),3);case 3:O=[];r=g.w(E);for(I=r.next();!I.done;I=r.next())N=I.value,L=g.sA(N.key).entityId,C=c6(N),kI=g.sA(C.action.entityKey).entityId,L!==x&&kI!==x||sz(k,N.actionProto)||O.push(N.key);return g.n(Fj,Cs(u,{mode:"readwrite",IU:!0},function(ob){var K=O.map(function(B){return vx(ob,B)});
K.push(vx(ob,F,{IL:!0}));return g.l3.all(K)}),6);
case 6:H6(c),m&&F1(m),Uz(U,{entityKey:F,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.wQ(Fj)}})},zG=function(x,u,k,U,m){var F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l;
return g.Z(function(a){switch(a.S){case 1:return F=g.H_(x,u),f=g.H_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(a,Cs(k,{mode:"readonly",IU:!0},function(e){return g.l3.all([Px(e,F,u),Px(e,f,"musicDownloadsLibraryEntity"),NZ(e,u),NZ(e,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=a.V;h=g.w(V);X=h.next().value;q=h.next().value;H=h.next().value;R=h.next().value;p=X;c=q;Y=H;E=R;if(!p){a.TY(3);break}return g.n(a,w1m(p,Y),4);case 4:return z=a.V,g.n(a,wg(z),3);case 3:O=[];r=new Map;if(!p){a.TY(6);break}return g.n(a,ylt(p,Y,c),7);case 7:O=a.V;I=g.w(O);for(N=I.next();!N.done;N=I.next())L=N.value,C=g.sA(L).entityId,r.set(C,{videoId:C,playlistId:x,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.n(a,SY(k,"transfer"),8);case 8:for(kI=a.V,Fj=g.w(kI),
ob=Fj.next();!ob.done;ob=Fj.next())K=ob.value,B=g.sA(K.key).entityId,(y=r.get(B))&&K&&(y.cotn=K.cotn);case 6:v=[];P4=g.w(E);for(Yw=P4.next();!Yw.done;Yw=P4.next())so=Yw.value,OY=g.sA(so.key).entityId,SW=c6(so),OY!==x&&SW.rootActionId!==x||sz(U,so.actionProto)||v.push(so.key);mm=g.H_(x,u);return g.n(a,Cs(k,{mode:"readwrite",IU:!0},function(e){var xI=v.map(function(UY){return vx(e,UY)});
xI.push(vx(e,mm,{IL:!0}));return g.l3.all(xI)}),9);
case 9:if(!p){a.TY(0);break}O.reverse();if(!O.length){a.TY(0);break}pm=g.w(O);G=pm.next();case 12:if(G.done){a.TY(0);break}W=G.value;l=g.sA(W).entityId;if(!l){a.TY(13);break}return g.n(a,GG(l,k,U,m,r.get(l)),13);case 13:G=pm.next(),a.TY(12)}})},W6=function(x,u,k){var U,m,F,f,V,h,X;
return g.Z(function(q){if(q.S==1)return g.n(q,Cs(x,{mode:"readwrite",IU:!0},function(H){var R=NZ(H,"transfer"),p=NZ(H,"offlineOrchestrationActionWrapperEntity");return g.l3.all([R,p]).then(function(c){c=g.w(c);var Y=c.next().value;var E=c.next().value;c=YZG.map(function(I){return fko(H,I)});
E=g.w(E);for(var z=E.next();!z.done;z=E.next()){z=z.value;var O=g.sA(z.actionProto.entityKey).entityType==="musicTrack",r=z.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";sz(u,z.actionProto)||O&&(!O||r)||c.push(vx(H,z.key,{IL:!0}))}return g.l3.all(c).then(function(){return Y})})}),2);
U=q.V;m=g.w(U);for(F=m.next();!F.done;F=m.next())f=F.value,H6(f),V=g.sA(f.key).entityId,h={videoId:V,offlineDeleteReason:void 0,cotn:f.cotn},F1(h),X=g.H_(V,"musicTrack"),Uz(k,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.n(q,mCt(),0)})},tr$=function(x){for(var u,k=g.w(x.additionalMetadatas),U=k.next();!U.done;U=k.next())U=U.value,U.offlineMusicVideoData&&(u=U.offlineMusicVideoData);
var m,F,f,V,h;return{id:g.H_(x.videoId,"musicTrack"),videoId:x.videoId,title:x.title,thumbnailDetails:x.thumbnail,lengthMs:String(Number(x.lengthSeconds)*1E3),albumTitle:(m=u)==null?void 0:m.releaseTitle,musicVideoType:(F=u)==null?void 0:F.musicVideoType,contentRating:{explicitType:(f=u)==null?void 0:f.explicitType},artistNames:((V=u)==null?void 0:V.byline)||((h=u)==null?void 0:h.channelName),downloadMetadata:g.H_(x.videoId,"musicTrackDownloadMetadataEntity")}},ylt=function(x,u,k){var U,m,F,f,V,h,
X,q,H,R,p,c,Y,E,z,O,r,I;
return g.Z(function(N){U=[];m=new Set;if((F=k)==null?0:(f=F.downloadedTracks)==null?0:f.length)for(V=g.w(k.downloadedTracks),h=V.next();!h.done;h=V.next())X=h.value,m.add(X);if(x.tracks){q=g.w(x.tracks);for(H=q.next();!H.done;H=q.next())R=H.value,m.has(R)||U.push(R);p=g.w(u);for(c=p.next();!c.done;c=p.next())if(Y=c.value,Y.id!==x.id&&(E=Y.tracks))for(z=g.w(E),O=z.next();!O.done;O=z.next())r=O.value,I=U.indexOf(r),I!==-1&&U.splice(I,1)}return N.return(U)})},w1m=function(x,u){var k,U,m,F,f,V,h,X;
return g.Z(function(q){k=RH(x.thumbnailDetails);U=g.w(u);for(m=U.next();!m.done;m=U.next())if(F=m.value,F.id!==x.id)for(f=g.w(RH(F.thumbnailDetails)),V=f.next();!V.done;V=f.next())h=V.value,X=k.indexOf(h),X!==-1&&k.splice(X,1);return q.return(k)})},E0S=function(x,u){var k,U,m,F,f,V,h,X,q;
return g.Z(function(H){if(H.S==1)return k=g.H_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(H,D3(x,k,"musicDownloadsLibraryEntity"),2);(U=H.V)||(U={id:k});m=g.sA(u).entityType;m==="musicTrack"?(F=U.downloadedTracks)!=null&&F.includes(u)||(U.downloadedTracks=((f=U.downloadedTracks)!=null?f:[]).concat(u)):m==="musicPlaylist"?(V=U.downloadedPlaylists)!=null&&V.includes(u)||(U.downloadedPlaylists=((h=U.downloadedPlaylists)!=null?h:[]).concat(u)):m!=="musicAlbumRelease"||(X=U.downloadedAlbumReleases)!=
null&&X.includes(u)||(U.downloadedAlbumReleases=((q=U.downloadedAlbumReleases)!=null?q:[]).concat(u));return g.n(H,Ls(x,U,"musicDownloadsLibraryEntity"),0)})},G3$=function(x,u){var k,U,m,F,f,V,h;
return g.Z(function(X){if(X.S==1)return k=g.H_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.n(X,D3(x,k,"musicDownloadsLibraryEntity"),2);U=X.V;if(!U)return X.TY(0);m=g.sA(u).entityType;m==="musicTrack"?F=U.downloadedTracks:m==="musicPlaylist"&&(F=U.downloadedPlaylists);if((f=F)==null?0:f.length)for(V=0;V<F.length;V++)if(h=F[V],h===u){F.splice(V,1);break}return g.n(X,Ls(x,U,"musicDownloadsLibraryEntity"),0)})},zyG=function(x){var u=x.videos;
x=[];var k=[];if(u){u=g.w(u);for(var U=u.next();!U.done;U=u.next()){var m=U.value.offlineVideoData.videoId;U=g.H_(m,"musicTrack");m=g.H_(m,"musicTrackDownloadMetadataEntity");x.push(U);k.push(m)}}return{L9:x,X7:k}},Oz=function(x,u,k){u={track:tr$(u)};
k&&(u.playlistId=k);if(x=g.d(x.actionMetadata,Wno))u.maximumDownloadQuality=x.maximumDownloadQuality;return{musicTrackEntityActionMetadata:u}},i4B=function(x){var u,k,U,m,F,f,V,h;
return g.Z(function(X){switch(X.S){case 1:return u=g.qL(),k=iqm(x),U=g.Fb(O4$),g.YI(X,2),F={Ck:!0},g.n(X,g.g_(u,k,U,void 0,F),4);case 4:m=X.V;g.EY(X,3);break;case 2:f=g.Gx(X);if(f instanceof g.ox)throw V="GetOffline network manager error: "+f.message,gg(V,f),Error(V);gg("GetOffline fetch request error",f);throw Error("GetOffline fetch request error");case 3:h=iv(m);if(!m)throw gg("Network request failed"),Error("Network request failed");if(h!==void 0)lv(h);else if(!m.videos||!m.videos.length)throw gg("No data"),
Error("No data");return X.return(m.videos.map(function(q){return q.offlineVideoData}))}})},lDZ=function(x){var u,k,U,m,F,f,V,h;
return g.Z(function(X){switch(X.S){case 1:return u=g.qL(),k=lkw(x),U=g.Fb(O4$),g.YI(X,2),F={Ck:!0},g.n(X,g.g_(u,k,U,void 0,F),4);case 4:m=X.V;g.EY(X,3);break;case 2:f=g.Gx(X);if(f instanceof g.ox)throw V="GetOffline network manager error for playlist: "+f.message,gg(V,f),Error(V);gg("GetOffline fetch request error for playlist",f);throw Error("GetOffline fetch request error for playlist");case 3:h=iv(m);if(!m)throw gg("Network request failed for playlist"),Error("Network request failed for playlist");
if(h!==void 0)lv(h,"playlist");else if(!m.playlists||!m.playlists.length)throw gg("No data for playlist"),Error("No data for playlist");return X.return(m.playlists.map(function(q){return q.offlinePlaylistData}))}})},$Ct=function(x,u,k,U){var m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so;
return g.Z(function(OY){switch(OY.S){case 1:return g.n(OY,Bx(),2);case 2:m=OY.V;if(!m)return OY.return([]);F=[];if((f=U)==null?0:f.length){F=U;OY.TY(3);break}return g.n(OY,SY(m,"mainPlaylistEntity"),4);case 4:F=OY.V;case 3:if(!F.length)return OY.return([]);V=[];h=Date.now()/1E3;X=g.w(F);q=X.next();case 5:if(q.done)return V.length?g.n(OY,n0Z(V),10):OY.return([]);H=q.value;if(!H.downloadState){R=void 0;OY.TY(8);break}return g.n(OY,D3(m,H.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:R=
OY.V;case 8:p=R;c=void 0;E=(Y=(c=H)==null?void 0:c.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;z=Number.isNaN(E)?x:E;r=O=void 0;I=((O=p)==null?0:O.lastSyncedTimestampMillis)?Number((r=p)==null?void 0:r.lastSyncedTimestampMillis)/1E3:0;L=N=void 0;C=((N=p)==null?0:N.addedTimestampMillis)?Number((L=p)==null?void 0:L.addedTimestampMillis)/1E3:0;if(k||!Y||I+z<=h){kI=[];Fj=void 0;if((Fj=H.videos)==null?0:Fj.length)for(ob=g.w(H.videos),K=ob.next();!K.done;K=
ob.next())B=K.value,y=JSON.parse(g.sA(B).entityId),y.videoId&&kI.push(y.videoId);v="0";Y&&(P4=void 0,v=String(Number((P4=Y.offlineLastModifiedTimestampSeconds)!=null?P4:0).toFixed()));Yw={playlistId:H.playlistId,videoIds:kI,offlineLastModifiedTimestamp:v,autoSync:u,offlineDateAddedTimestamp:String(C.toFixed())};V.push(Yw)}q=X.next();OY.TY(5);break;case 10:return so=OY.V,OY.return(so)}})},rlw=function(){var x,u,k,U,m;
return g.Z(function(F){if(F.S==1)return g.n(F,Bx(),2);if(F.S!=3)return(x=F.V)?g.n(F,SY(x,"refresh"),3):F.return(!1);u=F.V;if((k=u[0])==null||!k.refreshTime)return F.return(!1);U=Number(u[0].refreshTime);m=Date.now()/1E3;return F.return(isFinite(U)&&m>=U)})},Z4Z=function(x,u){var k,U,m;
return g.Z(function(F){switch(F.S){case 1:return g.YI(F,2),g.n(F,jAm(x,u),4);case 4:return U=F.V,g.n(F,qZm(U),5);case 5:k=H4m(U);g.EY(F,3);break;case 2:m=g.Gx(F),gg("getAndProcessSmartDownloadsResponse request or processing error",m);case 3:return F.return(k)}})},aDB=function(x,u,k,U){var m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so;
return g.Z(function(OY){switch(OY.S){case 1:return g.n(OY,Bx(),2);case 2:m=OY.V;if(!m)return OY.return([]);F=[];if((f=U)==null?0:f.length){F=U;OY.TY(3);break}return g.n(OY,SY(m,"musicPlaylist"),4);case 4:F=OY.V;case 3:if(!F.length)return OY.return([]);V=[];h=Date.now()/1E3;X=g.w(F);q=X.next();case 5:if(q.done)return V.length?g.n(OY,n0Z(V),10):OY.return([]);H=q.value;R=void 0;c=(p=(R=H)==null?void 0:R.entityMetadata)&&p.nextAutoRefreshIntervalSeconds?Number(p.nextAutoRefreshIntervalSeconds):NaN;Y=
Number.isNaN(c)?x:c;z=E=0;O="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!H.downloadMetadata){OY.TY(8);break}return g.n(OY,D3(m,H.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:r=OY.V,N=I=void 0,E=Number((N=(I=r)==null?void 0:I.addedTimestampMillis)!=null?N:"0")/1E3,C=L=void 0,z=Number((C=(L=r)==null?void 0:L.lastModifiedTimestampMillis)!=null?C:"0")/1E3,Fj=kI=void 0,O=(Fj=(kI=r)==null?void 0:kI.syncState)!=null?Fj:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ob=void 0;if(k||O!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!p||Number((ob=p.lastSyncedTimestampSeconds)!=null?ob:0)+Y<=h){K=[];B=void 0;if((B=H.tracks)==null?0:B.length)for(y=g.w(H.tracks),v=y.next();!v.done;v=y.next())P4=v.value,K.push(g.sA(P4).entityId);Yw={playlistId:H.playlistId,videoIds:K,offlineLastModifiedTimestamp:String(z.toFixed()),autoSync:u,offlineDateAddedTimestamp:String(E.toFixed())};V.push(Yw)}q=X.next();OY.TY(5);break;case 10:return so=OY.V,OY.return(so)}})},jAm=function(x,u){var k,U,m,F,f,V,h,X,q,H;
return g.Z(function(R){switch(R.S){case 1:return k=g.qL(),g.n(R,Bx(),2);case 2:U=R.V;if(!U){R.TY(3);break}return g.n(R,Qdm(U),4);case 4:m=R.V;case 3:var p=m;F={context:g.kl(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:x},offlineClientState:p,clientStateRequestData:{preferredFormatType:u}}}};f=g.Fb(QAB);g.YI(R,5);h={Ck:!0};return g.n(R,g.g_(k,F,f,void 0,h),7);case 7:V=R.V;g.EY(R,6);break;case 5:X=g.Gx(R);if(X instanceof g.ox)throw q=
"DPS network manager error for smart downloads: "+X.message,gg(q,X),Error(q);gg("DPS fetch request error for smart downloads",X);throw Error("DPS fetch request error for smart downloads");case 6:H=iv(V);if(V)H!==void 0&&lv(H,"smart downloads");else throw gg("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return R.return(V)}})},eyG=function(x,u){var k,U,m,F,f,V,h,X;
return g.Z(function(q){switch(q.S){case 1:return k=g.qL(),U={context:g.kl(),videoPlaybackPositionEntities:x,lastSyncTimestampUsec:u},m=g.Fb(IDS),g.YI(q,2),f={Ck:!0},g.n(q,g.g_(k,U,m,void 0,f),4);case 4:F=q.V;g.EY(q,3);break;case 2:V=g.Gx(q);if(V instanceof g.ox)throw h="VPPS network manager error: "+V.message,gg(h,V),Error(h);gg("VPPS fetch request error",V);throw Error("VPPS fetch request error");case 3:X=iv(F);if(F)X!==void 0&&lv(X,"position sync");else throw gg("Network request failed for position sync"),
Error("Network request failed for position sync");return q.return(F)}})},POm=function(x,u,k){var U,m,F,f,V,h,X,q;
return g.Z(function(H){switch(H.S){case 1:U=g.qL();var R=k.refreshData,p=k.isEnqueuedForExpiredStreamUrlRefetch,c=k.NO,Y=k.offlineSourceData,E=k.mediaCapabilities,z={entityKey:x};R&&(z.refreshData=R);p&&(z.isExpiredStreamUrlRefetch=p);c&&(z.downloadParameters=c);Y&&(z.offlineSourceData=Y);R={context:g.Fs(u),signatureTimestamp:20160,videos:[z]};E&&(R.mediaCapabilities=E);m=R;F=g.Fb(Jl$);g.YI(H,2);V={Ck:!0};return g.n(H,g.g_(U,m,F,void 0,V),4);case 4:f=H.V;g.EY(H,3);break;case 2:h=g.Gx(H);if(h instanceof
g.ox)throw X="GetPDE network manager error: "+h.message,gg(X,h),Error(X);gg("GetPDE fetch request error",h);throw Error("GetPDE fetch request error");case 3:q=iv(f);if(f)q!==void 0&&lv(q,"PDE");else throw gg("Network request failed for PDE"),Error("Network request failed for PDE");return H.return(f)}})},iv=function(x){var u;
return(u=x.errorMetadata)==null?void 0:u.status},lv=function(x,u){u=u?" for "+u:"";
if(x===0)throw x="Empty response body"+u,gg(x),Error(x);x="Response with error"+u;gg(x);throw Error(x);},n0Z=function(x){var u,k,U,m,F,f,V,h;
return g.Z(function(X){switch(X.S){case 1:return u=g.qL(),k=nSs(x),U=g.Fb(NOw),g.YI(X,2),F={Ck:!0},g.n(X,g.g_(u,k,U,void 0,F),4);case 4:m=X.V;g.EY(X,3);break;case 2:f=g.Gx(X);if(f instanceof g.ox)throw V="offlinePlaylistSyncCheck network manager error: "+f.message,gg(V,f),Error(V);gg("offlinePlaylistSyncCheck fetch request error",f);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:h=iv(m);if(!m)throw gg("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(h!==void 0)lv(h,"playlist sync");else if(!m.offlinePlaylistSyncCheckDatas||!m.offlinePlaylistSyncCheckDatas.length)throw gg("No data for playlist sync"),Error("No data for playlist sync");return X.return(m.offlinePlaylistSyncCheckDatas.map(function(q){return q.offlinePlaylistSyncCheckData}))}})},n9=function(x){this.S=x},dC$=function(x,u){var k,U,m,F,f,V;
return g.Z(function(h){switch(h.S){case 1:k=new Map,U=g.w(u),m=U.next();case 2:if(m.done){h.TY(4);break}F=m.value;f=k;V=f.set;return g.n(h,x.V(F),5);case 5:V.call(f,F,h.V);m=U.next();h.TY(2);break;case 4:return h.return(k)}})},$_=function(x,u,k,U,m,F){u=g.H_(u,k);
U=Object.assign({},F,{priority:U,retryScheduleIntervalsInSeconds:m});return{actionType:x,entityKey:u,actionMetadata:U}},rg=function(x,u,k,U,m,F){this.status=x;
this.S=u;this.K=k;this.V=U;this.J=m;this.downloadState=F},Knm=function(x,u,k){this.S=x;
this.x$=u;this.J=k},Alk=function(x,u){var k,U,m,F,f,V,h,X,q;
return g.Z(function(H){switch(H.S){case 1:return k=u.entityKey,m=(U=g.d(u.actionMetadata,j7))==null?void 0:U.isEnqueuedForExpiredStreamUrlRefetch,g.YI(H,2),F=void 0,g.n(H,v0G(x,u),4);case 4:F=H.V;g.YI(H,5);var R=(R=g.d(u.actionMetadata,j7))?{maximumDownloadQuality:R.maximumDownloadQuality}:void 0;return g.n(H,POm(k,x.x$,{isEnqueuedForExpiredStreamUrlRefetch:m,NO:R,offlineSourceData:F}),7);case 7:f=H.V;g.EY(H,6,2);break;case 5:return g.Gx(H,2),V=bv(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",gg("PDE handleAdd error"),H.return(ZU(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",V,"DOWNLOAD_STATE_FAILED"));case 6:return g.n(H,TOo(x,f,u),8);case 8:return H.return(ZU(u,!0,f.orchestrationActions));case 2:return h=g.Gx(H),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.t_&&h.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gg("PDE handleAdd error"),H.return(ZU(u,!1,void 0,X,q,"DOWNLOAD_STATE_FAILED"))}})},DCS=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj;
return g.Z(function(ob){switch(ob.S){case 1:return k=u.entityKey,U=g.sA(k).entityId,g.n(ob,Cs(x.S,{mode:"readonly",IU:!0},function(K){var B=Px(K,k,"playbackData"),y=Px(K,g.H_(U,"offlineVideoPolicy"),"offlineVideoPolicy");K=Px(K,g.H_(U,"transfer"),"transfer");return g.l3.all([B,y,K])}),2);
case 2:m=ob.V;F=g.w(m);f=F.next().value;V=F.next().value;h=F.next().value;X=f;q=V;H=h;if(!X||!q)return ob.return(ZU(u,!0));R=[];Y=((c=X)==null?0:c.playerResponseJson)?JSON.parse(X.playerResponseJson):null;if(!(H&&Y&&x.x$.G("html5_refresh_deprecated_downloads"))){ob.TY(3);break}p=COG(x,Y,H);return g.n(ob,Lnt(x,H),4);case 4:R=ob.V;case 3:E={lastPlayerResponseTimestampSeconds:X.playerResponseTimestamp,offlineToken:q.offlineToken,formatIds:R};z={};if((O=H)==null?0:O.maximumDownloadQuality)z.maximumDownloadQuality=
H.maximumDownloadQuality;g.YI(ob,5);r=void 0;return g.n(ob,v0G(x,u),7);case 7:return r=ob.V,g.YI(ob,8),g.n(ob,POm(k,x.x$,{refreshData:E,NO:z,offlineSourceData:r,mediaCapabilities:p}),10);case 10:I=ob.V;g.EY(ob,9,5);break;case 8:return g.Gx(ob,5),N=bv(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",gg("PDE handleRefresh error"),ob.return(ZU(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",N,
"DOWNLOAD_STATE_FAILED"));case 9:return g.n(ob,TOo(x,I,u),11);case 11:return ob.return(ZU(u,!0,I.orchestrationActions));case 5:return L=g.Gx(ob),C="PDE handleRefresh error",L instanceof Error&&(C="PDE handleRefresh error: "+L.message),kI="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Fj="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.t_&&L.type==="QUOTA_EXCEEDED"&&(kI="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Fj="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
gg(C),ob.return(ZU(u,!1,void 0,kI,Fj,"DOWNLOAD_STATE_FAILED"))}})},v0G=function(x,u){var k,U,m,F;
return g.Z(function(f){if(f.S==1)return k=g.sA(u.entityKey).entityId,U=g.H_(k,"videoDownloadContextEntity"),g.n(f,D3(x.S,U,"videoDownloadContextEntity"),2);m=f.V;return(F=m)!=null&&F.offlineModeType?f.return({offlineModeType:m.offlineModeType}):f.return(void 0)})},TOo=function(x,u,k){var U,m,F,f,V;
return g.Z(function(h){if(h.S==1){if(!u.frameworkUpdates||!g.d(u.frameworkUpdates,to))return h.return();if(!(g.d(u.frameworkUpdates,to).mutations&&g.d(u.frameworkUpdates,to).mutations.length>0&&g.d(u.frameworkUpdates,to).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return h.TY(2);U=g.sA(g.d(u.frameworkUpdates,to).mutations[0].entityKey).entityId;return g.n(h,Ez(x.S,U),3)}if(h.S!=2){m=h.V;F=g.d(k.actionMetadata,j7);if(V=(f=F)==null?void 0:f.playlistId)m.playlistId=V;m.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.BC(x.x$)?g.n(h,Y_(U,x.S,k,x.J,m),2):g.KD(x.x$)?g.n(h,GG(U,x.S,k,x.J),2):h.TY(2)}return g.n(h,yRG(g.d(u.frameworkUpdates,to)),0)})},ZU=function(x,u,k,U,m,F){return new rg(u?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",bv(x),k,U,m,F)},COG=function(x,u,k){u=k3s(x.x$,k.cotn,u);
k=g.Vm(u);return g.nrb(u,k,x.x$)},Lnt=function(x,u){var k,U,m,F,f,V,h,X,q,H,R;
return g.Z(function(p){if(p.S==1)return k=[],g.n(p,Cs(x.S,{mode:"readonly",IU:!0},function(c){var Y=[],E=u.offlineVideoStreams;if(E){E=g.w(E);for(var z=E.next();!z.done;z=E.next())Y.push(Px(c,z.value,"offlineVideoStreams"))}return g.l3.all(Y)}),2);
if(U=p.V)for(m=g.w(U),F=m.next();!F.done;F=m.next())if(f=F.value,V=void 0,(V=f)==null?0:V.streamsProgress)for(h=f.streamsProgress,X=0;X<h.length;X++)q=h[X],H=JSON.parse(q.formatStreamBytes),R={itag:H.itag,lmt:H.lastModified,xtags:H.xtags},k.push(R);return p.return(k)})},SZo=function(x,u){this.S=x;
this.x$=u},BOs=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p;
return g.Z(function(c){switch(c.S){case 1:return k=bv(u),g.n(c,SY(x.S,"videoPlaybackPositionEntity"),2);case 2:U=c.V;if(U.length===0)return c.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.YI(c,3);return g.n(c,I8.getInstance(),5);case 5:m=c.V;if(!m)throw Error("prefStorage is undefined");return g.n(c,m.get("psi"),6);case 6:return F=c.V,h=(V=(f=F)==null?void 0:f.aW)!=null?V:"0",g.n(c,eyG(U,h),7);case 7:return X=c.V,q={isPaused:X.watchHistoryPaused,aW:X.syncTimestampUsec},g.n(c,m.set("psi",
q),8);case 8:if(q.isPaused){c.TY(9);break}H=g.d(X.frameworkUpdates,to);if(!X.frameworkUpdates||!H){c.TY(9);break}return g.n(c,yRG(H),9);case 9:g.EY(c,4);break;case 3:return R=g.Gx(c),p="PPE handleRefresh error: "+(R instanceof Error?R.message:"unknown error"),gg(p),c.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},xPw=function(x,u){var k,U,m,F,f,V,h,X;
return g.Z(function(q){switch(q.S){case 1:return k=bv(u),U=g.sA(u.entityKey).entityId,g.YI(q,2),g.n(q,I8.getInstance(),4);case 4:m=q.V;if(!m)throw Error("prefStorage is undefined");return g.n(q,m.get("psi"),5);case 5:F=q.V;f=g.d(u.actionMetadata,oiZ);if(((V=F)==null?void 0:V.isPaused)!==!1||(h=f)==null||!h.lastPlaybackPositionSeconds){q.TY(6);break}X={key:g.H_(U,"videoPlaybackPositionEntity"),videoId:U,lastPlaybackPositionSeconds:f.lastPlaybackPositionSeconds};return g.n(q,Ls(x.S,X,"videoPlaybackPositionEntity"),
6);case 6:g.EY(q,3);break;case 2:return g.Gx(q),q.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return q.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},uRs=function(x,u){var k,U,m;
return g.Z(function(F){switch(F.S){case 1:k=bv(u);g.YI(F,2);U=g.sA(u.entityKey).entityId;if(U==="!*$_ALL_ENTITIES_!*$")return g.n(F,R0t(x.S),5);m=g.H_(U,"videoPlaybackPositionEntity");return g.n(F,HqS(x.S,m),5);case 5:g.EY(F,3);break;case 2:return g.Gx(F),F.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},gim=function(x,u){this.api=x;
this.S=u;this.logger=new g.fe("woffle");this.V=!1;this.nN={ST:this.ST};this.logger.debug("Initialized OfflineMediaManager")},khm=function(x){return g.Z(function(u){return u.return(OqZ(x))})},UPk=function(x){var u;
return g.Z(function(k){if(k.S==1)return g.n(k,g.gF$(x),2);u=k.V;return k.return(u.filter(function(U){return!!U.url}).map(function(U){return U.url}))})},aH=function(x,u){var k=g.$6(u);
if(k===1||k===0)return Promise.resolve();(k=mPw(x,u))&&k.stopVideo();x.J=0;return khm(u)},Qn=function(x,u,k,U){k=k===void 0?!1:k;
U=U===void 0?!0:U;var m=typeof u==="string"?u:u.videoDetails.videoId;g.$6(m)===2&&((u=mPw(x,m))?u.stopVideo():x.logger.info(function(){return"Corresponding player for "+m+" not found. Pausing anyway"}),g.ri(m,2),x.J=2,k?FQW(x.S):U&&fuw(x.S))},mPw=function(x,u){var k;
return((k=x.player)==null?void 0:k.getVideoData().videoId)===u?x.player:null},boS=function(x,u,k){u.getPlayerResponse();
g.ri(u.videoId,2);x.J=2;x.V=!1;var U;(U=x.player)==null||U.dispose();x.player=x.api.ww(u);u={};x.player.kJ((u.localmediachange=x.Cg,u.signatureexpired=x.Gr,u.statechange=x.I3m,u),x);var m=x.ST(k);x.player.KP(g.fx(m,m,!0,"m"),!1);x.logger.debug(function(){return"Starting headless playback with quality: "+m});
x.player.R$(!1)},V9t=function(x,u){this.S=x;
this.x$=u},XBo=function(x,u){var k,U;
return g.Z(function(m){switch(m.S){case 1:return k=bv(u),g.n(m,D3(x.S,u.entityKey,"transfer"),2);case 2:if(U=m.V)return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.YI(m,3);return g.n(m,his(x,u),5);case 5:g.EY(m,4);break;case 3:return g.Gx(m),m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},qyG=function(x,u){var k,U;
return g.Z(function(m){switch(m.S){case 1:return k=bv(u),g.n(m,D3(x.S,u.entityKey,"transfer"),2);case 2:U=m.V;if(!U||U.transferState!=="TRANSFER_STATE_COMPLETE")return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.YI(m,3);return g.n(m,his(x,u,!0),5);case 5:g.EY(m,4);break;case 3:return g.Gx(m),m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},sTW=function(x,u){var k,U,m,F,f,V,h,X,q,H;
return g.Z(function(R){switch(R.S){case 1:return k=bv(u),U=g.sA(u.entityKey).entityId,g.n(R,Cs(x.S,{mode:"readonly",IU:!0},function(p){var c=Px(p,u.entityKey,"transfer");p=Px(p,g.H_(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.l3.all([c,p])}),2);
case 2:m=R.V;F=g.w(m);f=F.next().value;V=F.next().value;h=f;X=V;if(!h||h.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return R.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.YI(R,3);h.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.n(R,Ls(x.S,h,"transfer"),5);case 5:q=g.sA(h.key).entityId;f9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:q,Jg:h,offlineModeType:(H=X)==null?void 0:H.offlineModeType});g.EY(R,
4);break;case 3:return g.Gx(R),R.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return R.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},his=function(x,u,k){k=k===void 0?!1:k;
var U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z;return g.Z(function(O){switch(O.S){case 1:return U=g.d(u.actionMetadata,Hom),m=g.sA(u.entityKey).entityId,F=g.H_(m,"downloadStatusEntity"),g.n(O,Cs(x.S,{mode:"readonly",IU:!0},function(r){var I=Px(r,F,"downloadStatusEntity");r=Px(r,g.H_(m,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.l3.all([I,r])}),2);
case 2:return f=O.V,V=g.w(f),h=V.next().value,X=V.next().value,q=h,H=X,R="TRANSFER_STATE_TRANSFER_IN_QUEUE",((p=q)==null?void 0:p.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(R="TRANSFER_STATE_PAUSED_BY_USER"),E={key:u.entityKey,transferState:R,cotn:g.lu(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(c=U)==null?void 0:c.maximumDownloadQuality,preferredAudioTrack:(Y=U)==null?void 0:Y.preferredAudioTrack,transferRetryCount:0,isRefresh:k,hasLoggedFirstStarted:!1},g.n(O,Cs(x.S,
{mode:"readwrite",IU:!0},function(r){var I=[];k&&I.push(vx(r,g.H_(m,"offlineVideoStreams")));I.push(Ks(r,E,"transfer"));return g.l3.all(I)}),3);
case 3:if(!k){O.TY(4);break}return g.n(O,khm(m),4);case 4:f9({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:m,Jg:E,offlineModeType:(z=H)==null?void 0:z.offlineModeType}),g.wQ(O)}})},pBZ=function(x,u,k,U){if(!x.action.entityKey)throw Error("entityKey is missing.");
var m=g.sA(x.action.entityKey);m={entityType:m.o6,entityId:m.entityId,offlineOrchestrationActionType:x.action.actionType,orchestrationAction:{orchestrationActionId:x.actionId}};u&&(m.offlineOrchestrationActionResult=u.status,m.isRetryable=k?!1:u.S,u.J&&(m.offlineOrchestrationFailureReason=RiB(u.J,m.isRetryable)));var F,f;if((F=x.action.actionMetadata)==null?0:(f=F.offlineLoggingData)==null?0:f.offlineModeType)m.offlineModeType=x.action.actionMetadata.offlineLoggingData.offlineModeType;U&&(m.additionalOrchestrationActions=
U.map(function(V){return{orchestrationActionId:V.actionId}}));
return m},RiB=function(x,u){return x!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||u?x==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&u?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":x:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},c5k=function(x,u){var k={offlineOrchestrationContext:pBZ(x)};
u=Zqm(u,k);aks(jdZ(),u,x.rootActionId)},M9W=function(x,u,k,U){U=U===void 0?[]:U;
u={offlineOrchestrationContext:pBZ(x,u,k,U)};u=Zqm(3,u);aks(jdZ(),u,x.rootActionId)},wBZ=function(){this.actions=[]},y5m=function(x,u){u=g.w(u);
for(var k=u.next();!k.done;k=u.next())k=k.value,c5k(k,1),x.actions.push(k);x.actions.sort(x.S)},Yyt=function(x,u){if(u)for(var k=0;k<x.actions.length;k++)if(u==="!*$_ALL_ENTITIES_!*$"&&x.actions[k].actionId!==u||u!=="!*$_ALL_ENTITIES_!*$"&&x.actions[k].rootActionId===u&&x.actions[k].actionId!==u)x.actions.splice(k,1),k--},t9S=function(x,u){x=g.w(x.actions);
for(var k=x.next();!k.done;k=x.next())if(k.value.actionId===u)return!0;return!1},IH=function(x,u,k,U,m){g.J.call(this);
var F=this;this.V=x;this.Ok=u;this.t5=k;this.D=U;this.x$=m;this.S=new wBZ;this.j=new g.xE;this.J=new g.gl(function(){F.retry()});
this.B=NaN;this.N=!1;this.nN={m5X:function(){return F.S},
ao:function(){return F.j},
IfJ:function(){return F.J},
retry:function(){return F.retry()}};
g.P(this,this.J);this.U=this.V.observe(this.RS.bind(this))},zi$=function(x,u,k,U,m){var F;
return g.Z(function(f){if(f.S==1)return F=new IH(x,u,k,U,m),g.n(f,Eik(F),2);Ght(F);return f.return(F)})},Ght=function(x){var u=x.S.actions[0];
return x.K?((u==null?void 0:u.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&x.K[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(x.N=!0),Promise.resolve()):WQG(x)},WQG=function(x){var u,k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z;
return g.Z(function(O){switch(O.S){case 1:if(x.K)throw Error("Already processing an action");if(x.Ft())return O.return();u=x.S.actions.shift();LMo(x.t5,!u);if(u===void 0)return O.return();u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&u.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&Yyt(x.S,u.actionId);k="";u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&u.rootActionId===u.actionId&&(k=u.actionId);U=[u];x.K=U;if(m=x.Ok[u.entityType]){O.TY(2);break}x.K=
void 0;return g.n(O,WQG(x),3);case 3:return O.return();case 2:F=g.w(U);for(f=F.next();!f.done;f=F.next())V=f.value,c5k(V,2);g.YI(O,4,5);return g.n(O,dC$(m,U.map(function(r){return r.action})),7);
case 7:h=O.V,X=g.w(U),q=X.next();case 8:if(q.done){O.TY(10);break}H=q.value;R=h.get(H.action);return g.n(O,Oo$(x,H,R),9);case 9:q=X.next();O.TY(8);break;case 10:Yyt(x.S,k);case 5:g.zx(O);x.K=void 0;g.W4(O,6);break;case 4:return p=g.Gx(O),gg("Orchestration error",p),g.YI(O,12),g.n(O,io9(x,U),14);case 14:g.EY(O,5);break;case 12:c=g.Gx(O);gg("Orchestration retry error",c);Y=g.w(U);for(E=Y.next();!E.done;E=Y.next())z=E.value,z.retryScheduleIndex<3&&y5m(x.S,[z]);O.TY(5);break;case 6:return g.n(O,WQG(x),
0)}})},Oo$=function(x,u,k){var U,m,F,f,V,h,X,q,H,R,p,c;
return g.Z(function(Y){switch(Y.S){case 1:U=u.retryScheduleIndex+2===3;if(k.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Y.TY(2);break}if(k.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Y.TY(0);break}M9W(u,k,U);if(k.S&&u.retryScheduleIndex+1<3)return g.n(Y,io9(x,[u]),0);F=((m=k)==null?0:m.V)?k.V:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";f={entityKey:u.action.entityKey,failureReason:F};V=void 0;g.BC(x.x$)?V="mainVideoDownloadStateEntity":g.KD(x.x$)&&(V="musicTrackDownloadMetadataEntity");
if(!V||!k.downloadState){Y.TY(7);break}h=g.sA(u.action.entityKey).entityId;return g.n(Y,qR(h,V,x.V,k.downloadState),7);case 7:Uz(x.D,f);if(k.downloadState==="DOWNLOAD_STATE_FAILED"&&x.x$.G("html5_auto_retry_failed_pde_actions")){Y.TY(0);break}gg("Orchestration result is not retryable, deleting action");return g.n(Y,HqS(x.V,MR(u).key),0);case 2:X=void 0;try{X=(q=k.K)==null?void 0:q.map(function(E){return x.createAction(E,u)})}catch(E){return M9W(u,k,U),H={entityKey:u.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Uz(x.D,H),gg("Orchestration subactions creation error",E),Y.return()}M9W(u,k,U,X);if(!X){Y.TY(12);break}R=X.map(function(E){return MR(E)});
p=0;case 13:if(!(p<X.length)||x.N){Y.TY(15);break}return g.n(Y,Cs(x.V,{mode:"readwrite",IU:!0},function(E){var z=[];z.push(U4Z(E,R.slice(p,p+10),"offlineOrchestrationActionWrapperEntity"));return g.l3.all(z)}),16);
case 16:p+=10;Y.TY(13);break;case 15:if(x.N)return x.N=!1,Y.return();case 12:return c=MR(u),g.n(Y,HqS(x.V,c.key),17);case 17:c5k(u,4),g.wQ(Y)}})},r5Z=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p;
return g.Z(function(c){k=[];U=Infinity;m=4E3;F=g.w(u);for(f=F.next();!f.done;f=F.next())V=f.value,h=Number(V.enqueueTimeSec),X=luG(h),q=V.retryScheduleIndex,H=q!=null&&q>0,X>0&&H?(U=Math.min(U,h),m=Math.min(X,m)):k.push(V);isFinite(U)&&(!x.J.isActive()||U<x.B)&&(x.B=U,x.J.start(m));x.j.m2()||(R=k.length,k=k.filter(function(Y){var E;Y=((E=Y.actionProto)==null?void 0:E.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!nim.includes(Y)}),p=k.length<R,!x.J.isActive()&&p&&x.J.start(1));
k.length>0&&$Ps(x,k);return g.n(c,Ght(x),0)})},ZoS=function(x){var u,k,U,m,F,f,V;
return g.Z(function(h){if(h.S==1)return g.n(h,jTm(x),2);u=h.V;k=[];U=g.w(u);for(m=U.next();!m.done;m=U.next())F=m.value,f=g.sA(F.key),V=f.entityId,t9S(x.S,V)||k.push(F);return g.n(h,r5Z(x,k),0)})},luG=function(x){x=x*1E3-Date.now();
return x>4E3?4E3:x},io9=function(x,u){var k,U,m;
return g.Z(function(F){k=g.w(u);for(U=k.next();!U.done;U=k.next()){m=U.value;var f=void 0,V=void 0,h=((V=m.action)==null?void 0:(f=V.actionMetadata)==null?void 0:f.retryScheduleIntervalsInSeconds)||[1,2,4];f=1;m.retryScheduleIndex<h.length&&(f=h[m.retryScheduleIndex]);m.S=f*1E3+Date.now();m.retryScheduleIndex++}return g.n(F,auB(x,u),0)})},Eik=function(x){var u;
return g.Z(function(k){if(k.S==1)return g.n(k,SY(x.V,"offlineOrchestrationActionWrapperEntity"),2);u=k.V;return g.n(k,r5Z(x,u),0)})},$Ps=function(x,u){u.length!==0&&u.forEach(function(k){k=c6(k);
k.retryScheduleIndex<3&&y5m(x.S,[k])})},jTm=function(x,u){var k;
return g.Z(function(U){if(U.S==1)return g.n(U,SY(x.V,"offlineOrchestrationActionWrapperEntity",u),2);k=U.V;return U.return(k.filter(Y1B))})},auB=function(x,u){if(u.length===0)return Promise.resolve([]);
u=u.map(function(k){return MR(k)});
return sdt(x.V,u)},QTS=function(x){this.Ek=x;
this.S=void 0},Iu$=function(x,u){var k,U,m,F;
return g.Z(function(f){k=u.videoId;U=!0;if(u.captionTracks.length)m=uv9(u),x.S=new g.tH(x.Ek,u,m);else if(u.G1)F=g.XI4(u),x.S=new g.GV(x.Ek,u.G1,k,F,u.cS,u.eventId),U=u.cS;else return f.return();return f.return(new Promise(function(V){var h;(h=x.S)==null||h.B6({wO:function(){return g.Z(function(X){if(X.S==1)return g.n(X,x.wO(k,U),2);V();g.wQ(X)})},
Lj:function(){}})}))})},eim=function(x){var u;
return g.Z(function(k){if(k.S==1)return g.n(k,WMk(x),2);u=k.V;return k.return(!!u&&u.length>0)})},e7=function(x){g.J.call(this);
this.S=x;this.V=this.S.observe(this.J.bind(this))},J5W=function(x,u){var k,U,m,F,f,V,h;
return g.Z(function(X){switch(X.S){case 1:if(u.length===0)return X.return([]);k=u.map(function(q){return g.H_(q,"transfer")});
return g.n(X,SY(x.S,"transfer",k),2);case 2:U=X.V;m=U.filter(Y1B).map(function(q){return g.sA(q.key).entityId});
F=u.filter(function(q){return m.indexOf(q)===-1});
if(F.length===0)return X.return([]);f=g.w(F);V=f.next();case 3:if(V.done){X.TY(5);break}h=V.value;return g.n(X,khm(h),4);case 4:V=f.next();X.TY(3);break;case 5:return X.return(F)}})},dPZ=function(x,u,k,U,m,F){var f,V,h;
return g.Z(function(X){f="STREAM_TYPE_UNKNOWN";k.video&&k.audio?(f="STREAM_TYPE_AUDIO_AND_VIDEO",gg("unexpected stream type")):k.video&&!k.audio?f="STREAM_TYPE_VIDEO":!k.video&&k.audio&&(f="STREAM_TYPE_AUDIO");V=g.H_(u,"offlineVideoStreams");h={numBytesDownloaded:m.toFixed(),numTotalBytes:F.toFixed(),streamType:f,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(U),itag:f==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(k.itag):void 0};return g.n(X,Cs(x,{mode:"readwrite",IU:!0},
function(q){var H=Px(q,V,"offlineVideoStreams"),R=Px(q,g.H_(u,"transfer"),"transfer");return g.l3.all([H,R]).then(function(p){p=g.w(p);var c=p.next().value;p=p.next().value;if(!p)return vx(q,V).then(function(){});
var Y=PCw(c);c=N0m(c,U,h,V);var E=Ks(q,c,"offlineVideoStreams");PCw(c)>Y&&(p.lastProgressTimeMs=Date.now().toString());Y=[E];p.offlineVideoStreams||(p.offlineVideoStreams=[]);p.offlineVideoStreams.indexOf(V)===-1&&(p.offlineVideoStreams.push(V),Y.push(Ks(q,p,"transfer")));return g.l3.all(Y)})}),0)})},KQw=function(x,u){var k,U,m,F,f;
return g.Z(function(V){if(V.S==1)return k=g.H_(u,"offlineVideoStreams"),g.n(V,D3(x,k,"offlineVideoStreams"),2);U=V.V;if(!U||!U.streamsProgress)return V.return();m=g.w(U.streamsProgress);for(F=m.next();!F.done;F=m.next())f=F.value,f.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",f.numTotalBytes!==f.numBytesDownloaded&&(f.numBytesDownloaded=f.numTotalBytes);return g.n(V,Ls(x,U,"offlineVideoStreams"),0)})},N0m=function(x,u,k,U){if(x&&x.streamsProgress){U=x;
a:{u=u.itag+";"+u.xtags;for(var m=x.streamsProgress,F=0;F<m.length;F++){var f=JSON.parse(m[F].formatStreamBytes);if(f.itag+";"+f.xtags===u){m[F]=k;k=m;break a}}m.push(k);k=m}U.streamsProgress=k}else x={key:U,streamsProgress:[k]};return x},PCw=function(x){if(x==null?0:x.streamsProgress){var u=0;
x=x.streamsProgress;for(var k=0;k<x.length;k++){var U=x[k];isNaN(Number(U.numBytesDownloaded))?gg("stream progress bytes number invalid"):u+=Number(U.numBytesDownloaded)}return u}return 0},vis=function(x,u,k,U){g.J.call(this);
var m=this;this.V=x;this.api=u;this.IS=k;this.RS=U;this.j=new g.xE;this.K=new g.gl(function(){m.S&&m.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&m.j.m2()&&((m.S.transferRetryCount||0)<3?Qn(m.D,m.N,!1,!1):aH(m.D,m.N.videoDetails.videoId),m.T9("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.t5=this.ut=0;this.U=this.B=!1;this.GY=g.MT(this.api.X().experiments,"html5_transfer_processing_logs_interval");this.q$=new g.Pr(this);this.nN={Qnt:function(){return m.K},
WwG:function(){return m.RS},
ao:function(){return m.j}};
this.Ok=this.V.observe(this.tQ.bind(this));this.D=new gim(u,this);this.B$=new QTS(u);this.nm=new e7(this.V);this.c$=this.j.listen("publicytnetworkstatus-online",this.Ch.bind(this));this.gm=this.j.listen("publicytnetworkstatus-offline",this.Sit.bind(this));this.U=this.api.X().G("html5_less_transfer_processing_logs");g.P(this,this.q$);this.q$.Y(u,"offlinetransferpause",this.Vg$);g.BC(this.api.X())?this.J="mainVideoDownloadStateEntity":g.KD(this.api.X())&&(this.J="musicTrackDownloadMetadataEntity")},
T0B=function(x){return g.Z(function(u){if(u.S==1)u=g.n(u,GvB(),2);
else{var k=x.nm;var U=g.nO();U=Object.keys(U);k=J5W(k,U);u=g.n(u,k,0)}return u})},P6=function(x,u){u=u===void 0?!1:u;
var k;return g.Z(function(U){if(U.S==1){if(x.S)throw Error("Already downloading a video");x.t5=0;x.B=!1;return g.n(U,A5Z(x),2)}return U.S!=4?(k=U.V,D4t(x.IS,!k),k&&x.j.m2()?u?g.n(U,new Promise(function(m){g.Yc(m,1E3)}),4):U.TY(4):(!k&&x.S&&Jo(x),U.TY(0))):g.n(U,CC9(x,k),0)})},LQw=function(x){return g.Z(function(u){if(u.S==1)return x.N?g.n(u,aH(x.D,x.N.videoDetails.videoId),3):u.TY(0);
Jo(x);g.wQ(u)})},DPG=function(x,u){var k,U,m;
return g.Z(function(F){switch(F.S){case 1:return g.YI(F,2),(k=!!u.captionTracks.length||!!u.G1)?g.n(F,eim(u.videoId),4):F.return();case 4:return(U=F.V)?F.return():g.n(F,Iu$(x.B$,u),5);case 5:g.EY(F,0);break;case 2:m=g.Gx(F),gg("Caption downloading error",m,u.cotn),g.wQ(F)}})},CC9=function(x,u){var k,U,m,F,f,V;
return g.Z(function(h){switch(h.S){case 1:if(x.B)return h.return();x.B=!0;x.S=u;k=g.sA(x.S.key);U=k.entityId;m=void 0;if(x.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.n(h,NR(x,U),7);if(x.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||x.S.transferRetryCount||x.S.hasLoggedFirstStarted){h.TY(3);break}return g.n(h,NR(x,U),5);case 5:return m=h.V,x.S.hasLoggedFirstStarted=!0,g.n(h,Sys(x),6);case 6:S19({videoId:U,Jg:x.S,offlineModeType:m},void 0,void 0,!0);h.TY(3);break;case 7:m=h.V,
f9({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:U,Jg:x.S,offlineModeType:m});case 3:return g.n(h,B0G(x),8);case 8:return F=null,g.YI(h,9),g.n(h,oyS(x,u),11);case 11:F=h.V;x.N=F;g.EY(h,10);break;case 9:return f=g.Gx(h),gg("error getting player response",f,u.cotn),g.n(h,x.T9("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return h.return();case 10:return V=k3s(x.api.X(),u.cotn,F),g.n(h,DPG(x,V),13);case 13:return g.n(h,UPk(V.videoId),
14);case 14:V.Bn=h.V,boS(x.D,V,u.maximumDownloadQuality),x.K.start(108E5),g.wQ(h)}})},A5Z=function(x){var u,k;
return g.Z(function(U){if(U.S==1)return g.n(U,SY(x.V,"transfer"),2);u=U.V;k=u.filter(xNm).sort(uH9);return k.length===0?U.return():U.return(k[0])})},B0G=function(x){var u,k,U;
return g.Z(function(m){if(m.S==1){if(!x.S)return dg(x,"onTransferStart"),m.return();x.K.start(108E5);return g.n(m,K9(x,"TRANSFER_STATE_TRANSFERRING"),2)}u=x.S;return(U=((k=u)==null?0:k.key)?g.sA(u.key).entityId:"")&&x.J?g.n(m,qR(U,x.J,x.V,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):m.TY(0)})},FQW=function(x){var u,k,U,m;
g.Z(function(F){switch(F.S){case 1:if(!x.S){dg(x,"onTransferPausedByUser");F.TY(2);break}u=x.S;x.K.stop();return g.n(F,K9(x,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:U=((k=u)==null?0:k.key)?g.sA(u.key).entityId:"";if(!U||!x.J){F.TY(4);break}return g.n(F,qR(U,x.J,x.V,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.n(F,NR(x,U),6);case 6:m=F.V,B4B({videoId:U,Jg:u,offlineModeType:m});case 2:Jo(x),P6(x),g.wQ(F)}})},fuw=function(x){var u,k,U;
g.Z(function(m){if(m.S==1){if(!x.S)return dg(x,"onTransferPausedByNetwork"),m.return();x.K.stop();return g.n(m,K9(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(m.S!=3)return u=x.S,(U=((k=u)==null?0:k.key)?g.sA(u.key).entityId:"")&&x.J?g.n(m,qR(U,x.J,x.V,"DOWNLOAD_STATE_PAUSED"),3):m.TY(3);Jo(x);g.wQ(m)})},gyG=function(x){var u,k,U,m,F;
g.Z(function(f){switch(f.S){case 1:if(!x.S)return dg(x,"onTransferComplete"),f.return();u=x.S;x.K.stop();if(!u||!x.N){f.TY(2);break}k=k3s(x.api.X(),u.cotn,x.N);return g.n(f,DPG(x,k),2);case 2:return g.n(f,K9(x,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:m=((U=u)==null?0:U.key)?g.sA(u.key).entityId:"";if(!m||!x.J){f.TY(5);break}return g.n(f,qR(m,x.J,x.V,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.n(f,KQw(x.V,m),7);case 7:return g.n(f,NR(x,m),8);case 8:F=f.V,f9({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:m,Jg:u,offlineModeType:F}),Jo(x),P6(x),g.wQ(f)}})},kns=function(x,u,k){var U,m;
g.Z(function(F){switch(F.S){case 1:if(!x.S)return dg(x,"onTransferProgress: "+u),F.return();if(x.S.transferState==="TRANSFER_STATE_TRANSFERRING"){F.TY(2);break}return g.n(F,B0G(x),2);case 2:U=Date.now();if(!(U-x.ut>1E3)){F.TY(4);break}x.ut=U;return g.n(F,dPZ(x.V,k.videoId,k.V,k.H1,k.bytesDownloaded,k.S),5);case 5:if(x.U&&!(x.U&&U-x.t5>x.GY)){F.TY(4);break}x.t5=U;return g.n(F,NR(x,u),7);case 7:m=F.V,S19({videoId:u,Jg:x.S,offlineModeType:m},k.bytesDownloaded,k.S);case 4:x.K.start(108E5),g.wQ(F)}})},
UNS=function(x){var u=(x.S.transferRetryCount||0)<3;
u&&(x=x.S,x.transferRetryCount=(x.transferRetryCount||0)+1);return u},mNs=function(x,u){u=u===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":u;
var k,U,m,F;return g.Z(function(f){if(f.S==1)return x.S||dg(x,"setTransferToFailed: "+u),k="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u==="TRANSFER_FAILURE_REASON_NETWORK"?k="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":u==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(k="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.n(f,K9(x,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",u),2);if(f.S!=3)return Uz(x.RS,{entityKey:(U=x.S)==null?void 0:U.key,failureReason:k}),
m=x.S?g.sA(x.S.key).entityId:"",g.n(f,NR(x,m),3);F=f.V;var V={videoId:m,Jg:x.S,offlineModeType:F},h=u,X={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};h&&(X.transferFailureReason=h,X.failureReason=o0t(h));f9(X,V);g.wQ(f)})},K9=function(x,u,k,U){var m;
return g.Z(function(F){if(F.S==1){if(!x.S)return dg(x,"saveTransferState: "+u),F.return();x.S.transferState=u;x.S.failureReason=U;g.YI(F,2);return g.n(F,Sys(x,function(f){return k?NZ(f,"offlineVideoStreams",x.S.offlineVideoStreams).then(function(V){for(var h=g.w(V),X=h.next();!X.done;X=h.next())if((X=X.value)&&X.streamsProgress){X=g.w(X.streamsProgress);for(var q=X.next();!q.done;q=X.next())q.value.streamState=k}return U4Z(f,V.filter(function(H){return!!H}),"offlineVideoStreams")}):g.l3.resolve(void 0)}),
4)}if(F.S!=2)return g.EY(F,0);
m=g.Gx(F);return m instanceof g.t_&&m.type==="QUOTA_EXCEEDED"?g.n(F,x.T9("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):F.TY(0)})},Sys=function(x,u){var k;
return g.Z(function(U){if(!x.S)return U.return();k=x.S;return g.n(U,Cs(x.V,{mode:"readwrite",IU:!0},function(m){var F=[Ks(m,k,"transfer")];u&&F.push(u(m));return g.l3.all(F)}),0)})},Jo=function(x){x.S=void 0;
x.N=void 0;x.K.stop()},oyS=function(x,u){var k,U,m,F,f;
return g.Z(function(V){if(V.S==1)return k=g.sA(u.key),U=k.entityId,m=g.H_(U,"playbackData"),g.n(V,D3(x.V,m,"playbackData"),2);F=V.V;if((f=F)==null?0:f.playerResponseJson)return V.return(JSON.parse(F.playerResponseJson));throw Error("No PlayerResponse found");})},dg=function(x,u){x.api.A5("woffle",{mcte:u});
gg("missing current transfer entity.")},NR=function(x,u){var k,U,m;
return g.Z(function(F){if(F.S==1)return g.n(F,D3(x.V,g.H_(u,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);k=F.V;return F.return((m=(U=k)==null?void 0:U.offlineModeType)!=null?m:void 0)})},xNm=function(x){return FZG[x.transferState]!==void 0},uH9=function(x,u){var k=FZG[x.transferState],U=FZG[u.transferState];
return k!==U?k-U:Number(x.enqueuedTimestampMs)-Number(u.enqueuedTimestampMs)},v6=function(x,u){var k=this;
this.x$=x;this.api=u;this.j=new g.xE;this.N=new g.wJ;this.nN={yB:function(){return k.J.nN.yB()},
ao:function(){return k.j},
cVm:function(){return k.J},
TD:function(){return k.TD()},
fR:function(){return k.fR()},
X0:function(){return k.X0()},
xb:function(){return k.xb()},
CT:function(){return k.CT()},
mJ:function(U){return k.mJ(U)}};
this.J=new T4w(function(){return flG(k)},function(){k.X0()},this.api.Iz(),this.api.G.bind(this.api));
this.S=new k_(this.api);AR9(this.J)},flG=function(x){return g.Z(function(u){x.api.Xt("onOrchestrationBecameLeader");
return g.n(u,x.fR(),0)})},Vq9=function(x){var u,k;
return g.Z(function(U){if(U.S==1)return g.n(U,Bx(),2);if(U.S!=3){u=U.V;if(!u)return gg("PES is undefined"),U.return();x.V=new vis(u,x.api,x.J,x.S);k=x.Ec(u);return g.n(U,zi$(u,k,x.J,x.S,x.x$),3)}x.D=U.V;return g.n(U,bbk(x),0)})},bbk=function(x){var u;
return g.Z(function(k){switch(k.S){case 1:if(!x.V)return gg("transferManager is undefined"),k.return();if(x.V.S){k.TY(2);break}return g.n(k,P6(x.V),2);case 2:if(!x.x$.G("woffle_enable_main_downloads_library")){k.TY(4);break}return g.n(k,x.LZ(),4);case 4:if(!x.x$.G("html5_offline_playback_position_sync")){k.TY(6);break}return g.n(k,x.d6(),7);case 7:return g.n(k,x.mJ(864E5),6);case 6:return g.n(k,x.refreshAllStaleEntities(43200,!0),9);case 9:return g.n(k,x.LH(),10);case 10:if(!x.x$.G("html5_retry_downloads_for_expiration")){k.TY(11);
break}return g.n(k,x.CT(),11);case 11:return x.B=g.tX(function(){x.refreshAllStaleEntities(43200,!0);x.LH()},9E5),g.ks(g.mA(),function(){return x.xb()}),g.n(k,Bx(),13);
case 13:return u=k.V,g.n(k,vSm(u),14);case 14:CMZ(x.J),g.wQ(k)}})},hXo=function(){var x,u,k,U,m,F;
return g.Z(function(f){switch(f.S){case 1:return g.n(f,Bx(),2);case 2:x=f.V;if(!x)return f.return([]);u=Date.now()/1E3;return g.n(f,SY(x,"offlineVideoPolicy"),3);case 3:k=f.V,U=g.w(k),m=U.next();case 4:if(m.done){f.TY(6);break}F=m.value;if(!(F.expirationTimestamp&&Number(F.expirationTimestamp)<u)){f.TY(5);break}F.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";F.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.n(f,Ls(x,F,"offlineVideoPolicy"),5);
case 5:m=U.next();f.TY(4);break;case 6:return f.return(k.map(function(V){return V.key}))}})},TG=function(x,u,k,U,m){var F,f,V;
return g.Z(function(h){if(h.S==1)return g.n(h,Bx(),2);F=h.V;if(!F)return h.return([]);f=u.map(function(X){var q=g.H_(X,k);q={actionType:U,entityKey:q,actionMetadata:Object.assign({},UCm(),m)};U!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(q.actionMetadata.priority=0);X=new p9(k,X,q);return MR(X)});
V=sdt(F,f);AR9(x.J);return h.return(V)})},XNt=function(x,u,k,U){var m,F,f,V,h,X,q,H;
return g.Z(function(R){switch(R.S){case 1:m=[],F=g.w(u),f=F.next();case 2:if(f.done){R.TY(4);break}V=f.value;if(V.upToDate||k&&!V.shouldAutoSyncMetadata||!V.playlistId){R.TY(3);break}h={};switch(U){case "mainPlaylistEntity":X={nextAutoRefreshIntervalSeconds:V.checkInSeconds,autoSync:k};h={mainPlaylistEntityActionMetadata:X};break;case "musicPlaylist":q={autoSync:k},h={musicPlaylistEntityActionMetadata:q}}return g.n(R,TG(x,[V.playlistId],U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h),6);case 6:(H=
R.V)&&m.push.apply(m,g.t(H));case 3:f=F.next();R.TY(2);break;case 4:return R.return(m)}})},qVk=function(x,u){var k;
return g.Z(function(U){return u.length?(k=UCm(),g.AQ(k,j7,{isEnqueuedForExpiredStreamUrlRefetch:!0}),x.api.A5("qrd",{v:u.length}),U.return(TG(x,u,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k))):U.return([])})},s0s=function(x,u,k){this.S=x;
this.x$=u;this.J=k},pNm=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O;
return g.Z(function(r){switch(r.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,F=[],g.YI(r,2),g.n(r,Hbm(x,m),4);case 4:F=r.V;if(!(x.x$.G("woffle_enable_main_downloads_library")&&((f=F)==null?0:f.length))){r.TY(5);break}return g.n(r,clG(x.S,[u.entityKey]),5);case 5:g.EY(r,3);break;case 2:return V=g.Gx(r),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.t_&&V.type==="QUOTA_EXCEEDED"?(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):gg("Playlist add error"),r.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,h,X));case 3:q=[];if(!x.x$.G("html5_offline_prevent_redownload_downloaded_video")){r.TY(7);break}return g.n(r,g0S(x.S,"mainVideoEntity",F),8);case 8:F=r.V;case 7:if((H=F)==null?0:H.length)for(R=g.w(F),p=R.next();!p.done;p=R.next())if(c=p.value,Y=c.offlineVideoData,E=void 0,(E=Y)==null?0:E.videoId)z=void 0,O=Number(((z=u.actionMetadata)==null?void 0:z.priority)||
0)+1,q.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"mainVideoEntity",O,Ao,RXs(u,Y,m)));return r.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,q))}})},Mq9=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l,a,e,xI,UY,mk,Q,hY,pR,b5,$I,Hk,eB,sC,v4,J3,Vp,jp,ve,XN,vi,Pj,Ta,yU,qo,lw,sP,n8,aZ,QL,Wq,Bj,AT,k2,Gh,Pg;
return g.Z(function(Hj){switch(Hj.S){case 1:return k=bv(u),U=u.entityKey,m=g.sA(U).entityId,F=[],f=!1,m==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.n(Hj,SY(x.S,"mainPlaylistEntity"),5)):g.n(Hj,D3(x.S,U,"mainPlaylistEntity"),4);case 4:(V=Hj.V)&&F.push(V);Hj.TY(3);break;case 5:F=Hj.V;case 3:if((h=F)==null||!h.length)return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));X=g.d(u.actionMetadata,cWG);H=(q=X)==null?void 0:q.nextAutoRefreshIntervalSeconds;p=(R=X)==null?void 0:R.autoSync;c=[];E=Y=
!0;z=!1;if(!f&&p===!1){Hj.TY(6);break}g.YI(Hj,7);return g.n(Hj,$Ct(0,!!p,!0,F),9);case 9:c=Hj.V;g.EY(Hj,8);break;case 7:O=g.Gx(Hj);if(!(O instanceof Error&&O.message==="No data")){O instanceof Error&&O.message==="Empty response body"&&gg(O.message);Hj.TY(8);break}return m==="!*$_ALL_ENTITIES_!*$"?g.n(Hj,X1t(x.S,u,x.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.n(Hj,Vrm(m,x.S,u,x.J),8);case 8:if(!c.length||!f&&c[0].playlistId!==m)return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));case 6:if(f){r=[];I=g.w(c);for(N=I.next();!N.done;N=I.next())L=N.value,L.upToDate||p&&!L.shouldAutoSyncMetadata||!L.playlistId||(C={nextAutoRefreshIntervalSeconds:L.checkInSeconds,autoSync:p},r.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L.playlistId,"mainPlaylistEntity",0,Ao,{mainPlaylistEntityActionMetadata:C})));return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,r))}c.length&&(kI=c[0],z=!!kI.upToDate,p&&(Y=(Fj=kI.shouldAutoSyncMetadata)!=null?Fj:!0,E=(ob=kI.shouldAutoSyncVideos)!=
null?ob:!0,kI.checkInSeconds&&(H=kI.checkInSeconds)));if(z||!Y)return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));K=[];B=F[0];if(!B.downloadState){y=void 0;Hj.TY(15);break}return g.n(Hj,D3(x.S,B.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:y=Hj.V;case 15:return v=y,Yw=((P4=v)==null?0:P4.addedTimestampMillis)?String(v.addedTimestampMillis):void 0,g.YI(Hj,17),g.n(Hj,Hbm(x,m,Yw,H),19);case 19:K=Hj.V;g.EY(Hj,18);break;case 17:so=g.Gx(Hj);if(!(so instanceof Error&&
so.message==="No data for playlist")){if(so instanceof Error&&so.message==="Empty response body for playlist")gg(so.message);else return OY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SW="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",so instanceof g.t_&&so.type==="QUOTA_EXCEEDED"&&(OY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SW="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,OY,SW));Hj.TY(18);
break}return g.n(Hj,Vrm(m,x.S,u,x.J),18);case 18:if(!E)return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));mm=[];pm=new Map;if((G=K)==null?0:G.length)for(W=g.w(K),l=W.next();!l.done;l=W.next())a=l.value,e=a.offlineVideoData,xI=void 0,((xI=e)==null?0:xI.videoId)&&pm.set(e.videoId,e);UY=new Map;mk=[];if((Q=B)==null?0:(hY=Q.videos)==null?0:hY.length)for(pR=g.w(B.videos),b5=pR.next();!b5.done;b5=pR.next())if($I=b5.value,Hk=JSON.parse(g.sA($I).entityId),eB=Hk.videoId)pm.has(eB)?(UY.set(eB,
pm.get(eB)),pm.delete(eB)):mk.push(eB);v4=Number(((sC=u.actionMetadata)==null?void 0:sC.priority)||0)+1;J3=g.w(pm.entries());for(Vp=J3.next();!Vp.done;Vp=J3.next())jp=Vp.value,ve=g.w(jp),XN=ve.next().value,vi=ve.next().value,Pj=XN,Ta=vi,mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Pj,"mainVideoEntity",v4,Ao,RXs(u,Ta,m)));yU=g.w(UY.entries());for(qo=yU.next();!qo.done;qo=yU.next())lw=qo.value,sP=g.w(lw),n8=sP.next().value,aZ=sP.next().value,QL=n8,Wq=aZ,mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
QL,"mainVideoEntity",v4,Ao,RXs(u,Wq,m)));Bj=g.w(mk);for(AT=Bj.next();!AT.done;AT=Bj.next())k2=AT.value,Gh={playlistId:m},Pg={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Gh},mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",k2,"mainVideoEntity",0,Ao,Pg));return Hj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,mm))}})},wNw=function(x,u){var k,U,m,F;
return g.Z(function(f){switch(f.S){case 1:return k=bv(u),g.YI(f,2),U=g.sA(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.n(f,X1t(x.S,u,x.J,(m=u.actionMetadata)==null?void 0:(F=m.offlineLoggingData)==null?void 0:F.offlineDeleteReason),5):g.n(f,Vrm(U,x.S,u,x.J),6);case 6:if(!x.x$.G("woffle_enable_main_downloads_library")){f.TY(5);break}return g.n(f,Mrt(x.S,u.entityKey),5);case 5:g.EY(f,3);break;case 2:return g.Gx(f),f.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},Hbm=function(x,u,k,U){var m,F,f,V,h,X,q;
return g.Z(function(H){switch(H.S){case 1:return g.n(H,lDZ([u]),2);case 2:return m=H.V,g.n(H,yW9(x,m[0],k,U),3);case 3:return F=H.V,f=F.mainPlaylistEntity,V=F.uSm,X=fDo(f,(h=V)==null?void 0:h.avatar),g.YI(H,4),g.n(H,yn(X),6);case 6:g.EY(H,5);break;case 4:q=g.Gx(H),q instanceof Error&&q.message==="Failed to fetch"&&gg(q.message);case 5:return H.return(m[0].videos)}})},yW9=function(x,u,k,U){var m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I;
return g.Z(function(N){switch(N.S){case 1:m=Date.now().toString();k||(k=m);F=u.videos;f=u.playlistId;V=[];h=[];if(F)for(X=g.w(F),q=X.next();!q.done;q=X.next()){H=q.value;R=H.offlineVideoData;if(!R||!R.videoId)throw gg("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");p=R.videoId;c={videoId:p,playlistId:f};Y={id:g.H_(JSON.stringify(c),"mainPlaylistVideoEntity"),video:g.H_(p,"mainVideoEntity")};V.push(Y);h.push(Y.id)}z={key:g.H_(f,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:k,lastSyncedTimestampMillis:m};O={key:g.H_(f,"mainPlaylistEntity"),playlistId:f,videos:h,title:u.title,thumbnailStyleData:YVm(u),visibility:tqm(u),downloadState:z.key};u.channel&&(r=u.channel.offlineChannelData,E=Eyw(g.H_(f,"ytMainChannelEntity"),r),O.channelOwner=E.id);((I=O)==null?0:I.entityMetadata)?(O.entityMetadata.offlineLastModifiedTimestampSeconds=u.lastModifiedTimestamp,U&&(O.entityMetadata.nextAutoRefreshIntervalSeconds=String(U))):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:U?
String(U):void 0,offlineLastModifiedTimestampSeconds:u.lastModifiedTimestamp});g.YI(N,2);return g.n(N,Cs(x.S,{mode:"readwrite",IU:!0},function(L){var C=Ks(L,O,"mainPlaylistEntity"),kI=Ks(L,z,"mainPlaylistDownloadStateEntity");C=[C,kI];kI=g.w(V);for(var Fj=kI.next();!Fj.done;Fj=kI.next())C.push(Ks(L,Fj.value,"mainPlaylistVideoEntity"));E&&C.push(Ks(L,E,"ytMainChannelEntity"));return g.l3.all(C)}),4);
case 4:g.EY(N,3);break;case 2:throw g.Gx(N),gg("PES failure for playlist"),Error("PES failure for playlist");case 3:return N.return({mainPlaylistEntity:O,uSm:E,GHm:V})}})},Eyw=function(x,u){return{id:x,
channelId:u.channelId,title:u.title,avatar:u.thumbnail}},YVm=function(x){var u=[],k=x.videos;
k&&k.length>0&&u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:k[0].offlineVideoData.thumbnail}}});if((x=x.additionalMetadadatas)&&x.length>0)for(x=g.w(x),k=x.next();!k.done;k=x.next()){var U=k.value.offlineBundleItemPlaylistData,m=void 0;k=(m=U)==null?void 0:m.style;m=void 0;U={collageThumbnail:{coverThumbnail:(m=U)==null?void 0:m.coverThumbnail}};switch(k){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:U});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:U})}}return u},tqm=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},RXs=function(x,u,k){u={offlineVideoData:u,
playlistId:k};if(x=g.d(x.actionMetadata,cWG))u.maximumDownloadQuality=x.maximumDownloadQuality;return{mainVideoEntityActionMetadata:u}},Gno=function(x,u,k){this.S=x;
this.x$=u;this.J=k},ObG=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c;
return g.Z(function(Y){switch(Y.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,F=g.d(u.actionMetadata,C9),V=!((f=F)==null?0:f.playlistId),g.YI(Y,2),g.n(Y,zXS(x,m,void 0,(h=F)==null?void 0:h.offlineVideoData,V),4);case 4:g.EY(Y,3);break;case 2:return X=g.Gx(Y),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.t_&&X.type==="QUOTA_EXCEEDED"&&(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,q,H));case 3:R=1;R=Number(((p=u.actionMetadata)==null?void 0:p.priority)||0)+1;var E=(E=g.d(u.actionMetadata,C9))?{playbackDataActionMetadata:{maximumDownloadQuality:E.maximumDownloadQuality}}:void 0;c=$_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m,"playbackData",R,WZ9,E);return Y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,[c]))}})},ibB=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O;
return g.Z(function(r){switch(r.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,g.n(r,D3(x.S,u.entityKey,"mainVideoEntity"),2);case 2:F=r.V;if(!F){f=void 0;r.TY(3);break}return g.n(r,D3(x.S,F.downloadState,"mainVideoDownloadStateEntity"),4);case 4:f=r.V;case 3:V=f;if(!F||!V)return r.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));g.YI(r,5);return g.n(r,zXS(x,m,V.addedTimestampMillis,(X=g.d(u.actionMetadata,C9))==null?void 0:X.offlineVideoData),7);case 7:q=1;q=Number(((H=
u.actionMetadata)==null?void 0:H.priority)||0)+1;h=$_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m,"playbackData",q,WZ9);g.EY(r,6);break;case 5:R=g.Gx(r);if(!(R instanceof Error&&R.message==="No data")){if(R instanceof Error&&R.message==="Empty response body")gg(R.message);else return p="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",R instanceof g.t_&&R.type==="QUOTA_EXCEEDED"&&(p="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,p,c));r.TY(6);break}return g.n(r,Ez(x.S,m),9);case 9:Y=r.V;E=g.d(u.actionMetadata,C9);if(O=(z=E)==null?void 0:z.playlistId)Y.playlistId=O;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.n(r,Y_(m,x.S,u,x.J,Y),6);case 6:return r.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,h?[h]:void 0))}})},lls=function(x,u){var k,U,m,F,f,V,h,X,q,H;
return g.Z(function(R){switch(R.S){case 1:return k=bv(u),g.YI(R,2),U=g.sA(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.n(R,X1t(x.S,u,x.J,(q=u.actionMetadata)==null?void 0:(H=q.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.n(R,Ez(x.S,U),6);case 6:m=R.V;F=g.d(u.actionMetadata,C9);if(V=(f=F)==null?void 0:f.playlistId)m.playlistId=V;m.offlineDeleteReason=(h=u.actionMetadata)==null?void 0:(X=h.offlineLoggingData)==null?void 0:X.offlineDeleteReason;return g.n(R,Y_(U,x.S,u,x.J,m),7);
case 7:if(!x.x$.G("woffle_enable_main_downloads_library")){R.TY(5);break}return g.n(R,Mrt(x.S,u.entityKey),5);case 5:g.EY(R,3);break;case 2:return g.Gx(R),R.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k))}})},zXS=function(x,u,k,U,m){var F,f,V,h,X,q;
return g.Z(function(H){switch(H.S){case 1:if(F=U){H.TY(2);break}return g.n(H,i4B([u]),3);case 3:f=H.V,F=f[0];case 2:return g.n(H,nyo(x,F,k,m),4);case 4:V=H.V;h=V.mainVideoEntity;X=V.channelEntity;g.YI(H,5);var R=RH(h.thumbnail),p=RH(X.avatar);return g.n(H,yn(R.concat(p)),7);case 7:g.EY(H,0);break;case 5:q=g.Gx(H),q instanceof Error&&q.message==="Failed to fetch"&&gg(q.message),g.wQ(H)}})},nyo=function(x,u,k,U){var m,F,f,V,h,X,q,H,R,p,c,Y,E;
return g.Z(function(z){switch(z.S){case 1:k||(k=Date.now().toString());F=(m=u.channel)==null?void 0:m.offlineChannelData;f={id:g.H_(u.videoId,"ytMainChannelEntity"),channelId:F.channelId,title:F.title,avatar:F.thumbnail};V={key:g.H_(u.videoId,"mainVideoDownloadStateEntity"),playbackData:g.H_(u.videoId,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.H_(u.videoId,"videoDownloadContextEntity")};h={key:g.H_(u.videoId,"videoPlaybackPositionEntity"),videoId:u.videoId,lastPlaybackPositionSeconds:"0"};
x.x$.G("html5_offline_playback_position_sync")&&(X={playbackPosition:h.key});q=g.H_(u.videoId,"mainVideoEntity");H={key:q,videoId:u.videoId,title:u.title,thumbnail:u.thumbnail,localizedStrings:{viewCount:u.shortViewCountText},userState:X,lengthSeconds:u.lengthSeconds?Number(u.lengthSeconds):void 0,publishedTimestampMillis:u.publishedTimestamp?(Number(u.publishedTimestamp)*1E3).toString():void 0,formattedDescription:u.description,owner:f.id,downloadState:V.key};if(!x.x$.G("woffle_enable_main_downloads_library")||
!U){z.TY(2);break}return g.n(z,p1t(x.S,[q]),3);case 3:if(c=z.V)R=c.mainDownloadsLibraryEntity,p=c.mainDownloadsListEntity;case 2:return E=uuW,Y={key:g.H_(u.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.AQ(V,E,Y),g.n(z,Cs(x.S,{mode:"readwrite",IU:!0},function(O){var r=Ks(O,f,"ytMainChannelEntity"),I=Ks(O,V,"mainVideoDownloadStateEntity"),N=Ks(O,H,"mainVideoEntity");r=[r,I,N];x.x$.G("html5_offline_playback_position_sync")&&(I=Ks(O,h,"videoPlaybackPositionEntity"),
r.push(I));R&&(I=Ks(O,R,"mainDownloadsLibraryEntity"),r.push(I));p&&(I=Ks(O,p,"mainDownloadsListEntity"),r.push(I));Y&&(O=Ks(O,Y,"downloadStatusEntity"),r.push(O));return g.l3.all(r)}),4);
case 4:return z.return({mainVideoEntity:H,channelEntity:f})}})},$NG=function(x,u,k){this.S=x;
this.x$=u;this.J=k},j0Z=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B;
return g.Z(function(y){switch(y.S){case 1:return k=bv(u),U=[],g.n(y,I8.getInstance(),2);case 2:m=y.V;if(!m){y.TY(3);break}return g.n(y,m.get("sdois"),4);case 4:return F=y.V,g.n(y,(V=m)==null?void 0:V.get("lmqf"),5);case 5:f=y.V;case 3:g.YI(y,6);if(F===void 0)throw Error("prefStorage or opt-in state is undefined");h=[];if(F){y.TY(8);break}return g.n(y,Ryt(x.S),9);case 9:h=y.V,h.reverse();case 8:if(!h.length){y.TY(10);break}X=g.w(h);q=X.next();case 11:if(q.done){y.TY(10);break}H=q.value;if(!H){y.TY(12);
break}R=g.sA(H).entityId;return g.n(y,Ez(x.S,R),14);case 14:return p=y.V,p.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.n(y,Y_(R,x.S,{entityKey:H,actionType:u.actionType},x.J,p),12);case 12:q=X.next();y.TY(11);break;case 10:return g.n(y,jAm(F,(c=f)!=null?c:"SD"),16);case 16:return Y=y.V,g.n(y,qZm(Y),17);case 17:E=H4m(Y);if(!x.x$.G("woffle_enable_main_downloads_library")){y.TY(18);break}if(F){y.TY(19);break}return g.n(y,Mrt(x.S,g.Zg),19);case 19:return g.n(y,clG(x.S,[g.Zg]),18);
case 18:if((z=E)==null?0:z.length)for(O=g.w(E),r=O.next();!r.done;r=O.next())if(N=I=r.value,L=N.actionType,C=N.entityKey,kI=N.actionMetadata,L&&C&&kI&&!g.d(kI,rWm)){L==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(kI.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Fj=g.d(I.actionMetadata,C9))Fj.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",I.actionMetadata=Object.assign({},I.actionMetadata,{mainVideoEntityActionMetadata:Fj});U.push(I)}g.EY(y,7);break;
case 6:return ob=g.Gx(y),K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ob instanceof g.t_&&ob.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,K,B));case 7:return y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,U))}})},ZbS=function(){v6.apply(this,arguments);
this.U="mainVideoEntity"},alZ=function(x,u,k){u=u===void 0?43200:u;
k=k===void 0?!0:k;var U=U===void 0?!1:U;var m,F,f;return g.Z(function(V){switch(V.S){case 1:if(!x.j.m2())return V.return([]);m=[];g.YI(V,2);return g.n(V,$Ct(u,k,U),4);case 4:m=V.V;g.EY(V,3);break;case 2:F=g.Gx(V),F instanceof Error&&F.message==="No data"||F instanceof Error&&F.message==="Empty response body"&&gg(F.message);case 3:return f=XNt(x,m,k,"mainPlaylistEntity"),V.return(f)}})},Q0m=function(x,u,k,U){U=U===void 0?!1:U;
var m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O;return g.Z(function(r){switch(r.S){case 1:return m=[],g.n(r,rlw(),2);case 2:return(F=r.V)||U?g.n(r,Z4Z(u,k),3):r.return([]);case 3:f=r.V;if((V=f)==null||!V.length)return r.return([]);h={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};X=g.w(f);q=X.next();case 4:if(q.done){r.TY(6);break}R=H=q.value;p=R.actionType;c=R.entityKey;Y=R.actionMetadata;if(!(p&&c&&Y)||g.d(Y,rWm)){r.TY(5);break}p==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.offlineLoggingData=
h);E=g.sA(c);z=E.entityId;return g.n(r,TG(x,[z],"mainVideoEntity",p,Y),8);case 8:O=r.V,m=m.concat(O);case 5:q=X.next();r.TY(4);break;case 6:return r.return(m)}})},IlG=function(x,u){this.S=x;
this.J=u},JWt=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z;
return g.Z(function(O){switch(O.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,F=[],g.YI(O,2),g.n(O,eXk(x,m),4);case 4:F=O.V;if((f=F)==null||!f.length){O.TY(5);break}return g.n(O,E0S(x.S,u.entityKey),5);case 5:g.EY(O,3);break;case 2:return V=g.Gx(O),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.t_&&V.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,h,X));case 3:return q=[],g.n(O,g0S(x.S,"musicTrack",F),7);case 7:F=O.V;if(F.length)for(H=g.w(F),R=H.next();!R.done;R=H.next())if(p=R.value,c=p.offlineVideoData,Y=void 0,(Y=c)==null?0:Y.videoId)E=void 0,z=Number(((E=u.actionMetadata)==null?void 0:E.priority)||0)+1,q.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",z,L9,Oz(u,c,m)));return O.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,q))}})},
PBm=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l,a,e,xI,UY,mk,Q,hY,pR,b5,$I,Hk,eB,sC,v4,J3,Vp,jp,ve,XN,vi;
return g.Z(function(Pj){switch(Pj.S){case 1:return k=bv(u),U=u.entityKey,m=g.sA(U).entityId,F=[],f=!1,m==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.n(Pj,SY(x.S,"musicAlbumRelease"),5)):g.n(Pj,D3(x.S,U,"musicAlbumRelease"),4);case 4:(V=Pj.V)&&F.push(V);Pj.TY(3);break;case 5:F=Pj.V;case 3:if((h=F)==null||!h.length)return Pj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));if(f){X=[];q=g.w(F);for(H=q.next();!H.done;H=q.next())R=H.value,p=g.sA(R.id).entityId,X.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
p,"musicAlbumRelease",0,L9));return Pj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,X))}c=[];Y=F[0];E=void 0;if(!Y.downloadMetadata){Pj.TY(6);break}return g.n(Pj,D3(x.S,Y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:z=Pj.V,E=Number((r=(O=z)==null?void 0:O.addedTimestampMillis)!=null?r:"0")/1E3;case 6:return g.YI(Pj,8),g.n(Pj,eXk(x,m,(I=E)==null?void 0:I.toString()),10);case 10:c=Pj.V;g.EY(Pj,9);break;case 8:N=g.Gx(Pj);if(!(N instanceof Error&&N.message===
"No data")){if(N instanceof Error&&N.message==="Empty response body")gg(N.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.t_&&N.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Pj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,L,C));Pj.TY(9);break}return g.n(Pj,zG(m,"musicAlbumRelease",x.S,
u,x.J),9);case 9:kI=[];Fj=new Map;if((ob=c)==null?0:ob.length)for(K=g.w(c),B=K.next();!B.done;B=K.next())y=B.value,v=y.offlineVideoData,P4=void 0,((P4=v)==null?0:P4.videoId)&&Fj.set(v.videoId,v);Yw=new Map;so=[];if((OY=Y)==null?0:(SW=OY.tracks)==null?0:SW.length)for(mm=g.w(Y.tracks),pm=mm.next();!pm.done;pm=mm.next())if(G=pm.value,W=g.sA(G).entityId)Fj.has(W)?(Yw.set(W,Fj.get(W)),Fj.delete(W)):so.push(W);a=Number(((l=u.actionMetadata)==null?void 0:l.priority)||0)+1;e=g.w(Fj.entries());for(xI=e.next();!xI.done;xI=
e.next())UY=xI.value,mk=g.w(UY),Q=mk.next().value,hY=mk.next().value,pR=Q,b5=hY,kI.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",pR,"musicTrack",a,L9,Oz(u,b5)));$I=g.w(Yw.entries());for(Hk=$I.next();!Hk.done;Hk=$I.next())eB=Hk.value,sC=g.w(eB),v4=sC.next().value,J3=sC.next().value,Vp=v4,jp=J3,kI.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Vp,"musicTrack",a,L9,Oz(u,jp)));ve=g.w(so);for(XN=ve.next();!XN.done;XN=ve.next())vi=XN.value,kI.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",vi,
"musicTrack",0,L9));return Pj.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,kI))}})},NlS=function(x,u){var k,U;
return g.Z(function(m){switch(m.S){case 1:return k=bv(u),g.YI(m,2),U=g.sA(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.n(m,W6(x.S,u,x.J),5):g.n(m,zG(U,"musicAlbumRelease",x.S,u,x.J),6);case 6:return g.n(m,G3$(x.S,u.entityKey),5);case 5:g.EY(m,3);break;case 2:return g.Gx(m),m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},eXk=function(x,u,k){var U,m,F;
return g.Z(function(f){switch(f.S){case 1:return g.n(f,lDZ([u]),2);case 2:return U=f.V,g.n(f,dNS(x,U[0],k),3);case 3:return m=f.V,F=RH(m.thumbnailDetails),g.n(f,yn(F),4);case 4:return f.return(U[0].videos)}})},dNS=function(x,u,k){var U,m,F,f,V,h,X,q,H,R,p,c,Y,E;
return g.Z(function(z){if(z.S==1){U=u.additionalMetadadatas;m=void 0;if(U&&U.length>0)for(F=g.w(U),f=F.next();!f.done;f=F.next())if(V=f.value,V.offlineMusicPlaylistData){m=V.offlineMusicPlaylistData;break}h=u.playlistId;X=zyG(u);q=X.L9;H=X.X7;R=k?(Number(k)*1E3).toString():Date.now().toString();p=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0";c={id:g.H_(h,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:H,lastModifiedTimestampMillis:p,addedTimestampMillis:R,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Y={id:g.H_(h,"musicAlbumRelease"),title:u.title,audioPlaylistId:h,trackCount:u.totalVideoCount,tracks:q,downloadMetadata:c.id};m&&(Y.thumbnailDetails=(E=m.albumHqThumbnail)!=null?E:m.albumArtistThumbnail,Y.artistDisplayName=m.albumArtistDisplayName,Y.releaseDate=m.albumReleaseDate,Y.contentRating={explicitType:m.albumReleaseExplicitType},Y.releaseType=m.albumReleaseType);return g.n(z,Cs(x.S,{mode:"readwrite",IU:!0},function(O){var r=Ks(O,Y,"musicAlbumRelease");
O=Ks(O,c,"musicAlbumReleaseDownloadMetadataEntity");return g.l3.all([r,O])}),2)}return z.return(Y)})},KZo=function(x,u){this.S=x;
this.J=u},Tlt=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z;
return g.Z(function(O){switch(O.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,F=[],g.YI(O,2),g.n(O,vy9(x,m),4);case 4:F=O.V;if((f=F)==null||!f.length){O.TY(5);break}return g.n(O,E0S(x.S,u.entityKey),5);case 5:g.EY(O,3);break;case 2:return V=g.Gx(O),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.t_&&V.type==="QUOTA_EXCEEDED"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,h,X));case 3:return q=[],g.n(O,g0S(x.S,"musicTrack",F),7);case 7:F=O.V;if(F.length)for(H=g.w(F),R=H.next();!R.done;R=H.next())if(p=R.value,c=p.offlineVideoData,Y=void 0,(Y=c)==null?0:Y.videoId)E=void 0,z=Number(((E=u.actionMetadata)==null?void 0:E.priority)||0)+1,q.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",z,DU,Oz(u,c,m)));return O.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,q))}})},
AWS=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm,G,W,l,a,e,xI,UY,mk,Q,hY,pR,b5,$I,Hk,eB,sC,v4,J3,Vp,jp,ve,XN,vi,Pj,Ta,yU,qo,lw,sP,n8,aZ,QL,Wq,Bj,AT;
return g.Z(function(k2){switch(k2.S){case 1:return k=bv(u),U=u.entityKey,m=g.sA(U).entityId,F=[],f=!1,m==="!*$_ALL_ENTITIES_!*$"?(f=!0,g.n(k2,SY(x.S,"musicPlaylist"),5)):g.n(k2,D3(x.S,U,"musicPlaylist"),4);case 4:(V=k2.V)&&F.push(V);k2.TY(3);break;case 5:F=k2.V;case 3:if((h=F)==null||!h.length)return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));X=g.d(u.actionMetadata,Wno);H=(q=X)==null?void 0:q.autoSync;R=[];c=p=!0;Y=!1;E=void 0;if(!f&&H===!1){k2.TY(6);break}g.YI(k2,7);return g.n(k2,
aDB(0,!!H,!0,F),9);case 9:R=k2.V;g.EY(k2,8);break;case 7:z=g.Gx(k2);if(!(z instanceof Error&&z.message==="No data")){z instanceof Error&&z.message==="Empty response body"&&gg(z.message);k2.TY(8);break}return m==="!*$_ALL_ENTITIES_!*$"?g.n(k2,W6(x.S,u,x.J),8):g.n(k2,zG(m,"musicPlaylist",x.S,u,x.J),8);case 8:if(!R.length||!f&&R[0].playlistId!==m)return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));case 6:if(f){O=[];r=g.w(R);for(I=r.next();!I.done;I=r.next())N=I.value,N.upToDate||
H&&!N.shouldAutoSyncMetadata||!N.playlistId||(L={autoSync:H},O.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N.playlistId,"musicPlaylist",0,DU,{musicPlaylistEntityActionMetadata:L})));return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,O))}R.length&&(C=R[0],Y=!!C.upToDate,H&&(p=(kI=C.shouldAutoSyncMetadata)!=null?kI:!0,c=(Fj=C.shouldAutoSyncVideos)!=null?Fj:!0,C.checkInSeconds&&(E=C.checkInSeconds)));if(Y||!p)return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));ob=[];K=F[0];B=void 0;if(!K.downloadMetadata){k2.TY(15);break}return g.n(k2,D3(x.S,K.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:y=k2.V,B=Number((P4=(v=y)==null?void 0:v.addedTimestampMillis)!=null?P4:"0")/1E3;case 15:return g.YI(k2,17),g.n(k2,vy9(x,m,(Yw=B)==null?void 0:Yw.toString(),E),19);case 19:ob=k2.V;g.EY(k2,18);break;case 17:so=g.Gx(k2);if(!(so instanceof Error&&so.message==="No data")){if(so instanceof Error&&so.message==="Empty response body")gg(so.message);else return OY=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SW="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",so instanceof g.t_&&so.type==="QUOTA_EXCEEDED"&&(OY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SW="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,OY,SW));k2.TY(18);break}return g.n(k2,zG(m,"musicPlaylist",x.S,u,x.J),18);case 18:if(!c)return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k));mm=[];pm=new Map;if((G=ob)==null?0:G.length)for(W=g.w(ob),l=W.next();!l.done;l=W.next())a=l.value,e=a.offlineVideoData,xI=void 0,((xI=e)==null?0:xI.videoId)&&pm.set(e.videoId,e);UY=new Map;mk=[];if((Q=K)==null?0:(hY=Q.tracks)==null?0:hY.length)for(pR=g.w(K.tracks),b5=pR.next();!b5.done;b5=pR.next())if($I=b5.value,Hk=g.sA($I).entityId)pm.has(Hk)?(UY.set(Hk,pm.get(Hk)),pm.delete(Hk)):mk.push(Hk);sC=Number(((eB=u.actionMetadata)==null?void 0:eB.priority)||0)+1;v4=g.w(pm.entries());for(J3=v4.next();!J3.done;J3=
v4.next())Vp=J3.value,jp=g.w(Vp),ve=jp.next().value,XN=jp.next().value,vi=ve,Pj=XN,mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",vi,"musicTrack",sC,DU,Oz(u,Pj)));Ta=g.w(UY.entries());for(yU=Ta.next();!yU.done;yU=Ta.next())qo=yU.value,lw=g.w(qo),sP=lw.next().value,n8=lw.next().value,aZ=sP,QL=n8,mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",aZ,"musicTrack",sC,DU,Oz(u,QL)));Wq=g.w(mk);for(Bj=Wq.next();!Bj.done;Bj=Wq.next())AT=Bj.value,mm.push($_("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
AT,"musicTrack",0,DU));return k2.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,mm))}})},CBm=function(x,u){var k,U;
return g.Z(function(m){switch(m.S){case 1:return k=bv(u),g.YI(m,2),U=g.sA(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.n(m,W6(x.S,u,x.J),5):g.n(m,zG(U,"musicPlaylist",x.S,u,x.J),6);case 6:return g.n(m,G3$(x.S,u.entityKey),5);case 5:g.EY(m,3);break;case 2:return g.Gx(m),m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},vy9=function(x,u,k,U){var m,F,f;
return g.Z(function(V){switch(V.S){case 1:return g.n(V,lDZ([u]),2);case 2:return m=V.V,g.n(V,LZW(x,m[0],k,U),3);case 3:return F=V.V,f=RH(F.thumbnailDetails),g.n(V,yn(f),4);case 4:return V.return(m[0].videos)}})},LZW=function(x,u,k,U){var m,F,f,V,h,X,q,H,R;
return g.Z(function(p){return p.S==1?(m=u.playlistId,F=zyG(u),f=F.L9,V=F.X7,h=k?(Number(k)*1E3).toString():Date.now().toString(),X=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0",q={id:g.H_(m,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:V,lastModifiedTimestampMillis:X,addedTimestampMillis:h,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},H={id:g.H_(m,"musicPlaylist"),title:u.title,playlistId:m,thumbnailDetails:u.thumbnail,visibility:DNG(u),trackCount:u.totalVideoCount,
tracks:f,downloadMetadata:q.id},U&&(((R=H)==null?0:R.entityMetadata)?H.entityMetadata.nextAutoRefreshIntervalSeconds=String(U):H&&(H.entityMetadata={nextAutoRefreshIntervalSeconds:String(U)})),g.n(p,Cs(x.S,{mode:"readwrite",IU:!0},function(c){var Y=Ks(c,H,"musicPlaylist");c=Ks(c,q,"musicPlaylistDownloadMetadataEntity");return g.l3.all([Y,c])}),2)):p.return(H)})},DNG=function(x){switch(x.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},SVG=function(x,u){this.S=x;
this.J=u},uf9=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c;
return g.Z(function(Y){switch(Y.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,F=g.d(u.actionMetadata,BlG),g.YI(Y,2),g.n(Y,oVw(x,m,void 0,(f=F)==null?void 0:f.track,(V=F)==null?void 0:V.albumRelease),4);case 4:if((h=F)==null?0:h.playlistId){Y.TY(5);break}return g.n(Y,E0S(x.S,u.entityKey),5);case 5:g.EY(Y,3);break;case 2:return X=g.Gx(Y),q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.t_&&X.type==="QUOTA_EXCEEDED"&&
(q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,q,H));case 3:p=Number(((R=u.actionMetadata)==null?void 0:R.priority)||0)+1;var E=(E=g.d(u.actionMetadata,BlG))?{playbackDataActionMetadata:{maximumDownloadQuality:E.maximumDownloadQuality}}:void 0;c=$_("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",m,"playbackData",p,xrm,E);return Y.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k,[c]))}})},gVS=function(x,u){var k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E;
return g.Z(function(z){switch(z.S){case 1:return k=bv(u),U=g.sA(u.entityKey),m=U.entityId,g.n(z,D3(x.S,u.entityKey,"musicTrack"),2);case 2:F=z.V;if(!F){f=void 0;z.TY(3);break}return g.n(z,D3(x.S,F.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:f=z.V;case 3:V=f;if(!F||!V)return z.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k));X=g.d(u.actionMetadata,BlG);g.YI(z,5);return g.n(z,oVw(x,m,V.addedTimestampMillis,(q=X)==null?void 0:q.track,(H=X)==null?void 0:H.albumRelease),
7);case 7:p=Number(((R=u.actionMetadata)==null?void 0:R.priority)||0)+1;h=$_("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",m,"playbackData",p,xrm);g.EY(z,6);break;case 5:c=g.Gx(z);if(!(c instanceof Error&&c.message==="No data")){if(c instanceof Error&&c.message==="Empty response body")gg(c.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.t_&&c.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,Y,E));z.TY(6);break}return g.n(z,GG(m,x.S,u,x.J),6);case 6:return z.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",k,h?[h]:void 0))}})},kDt=function(x,u){var k,U;
return g.Z(function(m){switch(m.S){case 1:return k=bv(u),g.YI(m,2),U=g.sA(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.n(m,W6(x.S,u,x.J),5):g.n(m,GG(U,x.S,u,x.J),6);case 6:return g.n(m,G3$(x.S,u.entityKey),5);case 5:g.EY(m,3);break;case 2:return g.Gx(m),m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new rg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
k))}})},oVw=function(x,u,k,U,m){var F,f,V,h,X,q;
return g.Z(function(H){switch(H.S){case 1:if(F=U){H.TY(2);break}return g.n(H,i4B([u]),3);case 3:f=H.V,V=f[0],F=tr$(V);case 2:return g.n(H,Uro(x,F,u,m,k),4);case 4:h=H.V;X=h.musicTrackEntity;q=h.ZF;var R=RH(X.thumbnailDetails),p=[];q&&(p=RH(q.thumbnailDetails));return g.n(H,yn(R.concat(p)),0)}})},Uro=function(x,u,k,U,m){var F;
return g.Z(function(f){return f.S==1?(m||(m=Date.now().toString()),F={id:g.H_(k,"musicTrackDownloadMetadataEntity"),playbackData:g.H_(k,"playbackData"),addedTimestampMillis:m,videoDownloadContextEntity:g.H_(k,"videoDownloadContextEntity")},U&&(u.albumRelease=U.id),g.n(f,Cs(x.S,{mode:"readwrite",IU:!0},function(V){var h=[],X=Ks(V,F,"musicTrackDownloadMetadataEntity");h.push(X);X=Ks(V,u,"musicTrack");h.push(X);U&&(V=Ks(V,U,"musicAlbumRelease"),h.push(V));return g.l3.all(h)}),2)):f.S!=3?g.n(f,qR(k,"musicTrackDownloadMetadataEntity",
x.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):f.return({musicTrackEntity:u,
ZF:U})})},S7=function(){v6.apply(this,arguments);
this.U="musicTrack"},mrG=function(x,u,k){u=u===void 0?43200:u;
k=k===void 0?!0:k;var U=U===void 0?!1:U;var m,F;return g.Z(function(f){switch(f.S){case 1:if(!x.j.m2())return f.return([]);m=[];g.YI(f,2);return g.n(f,aDB(u,k,U),4);case 4:m=f.V;g.EY(f,3);break;case 2:g.Gx(f);case 3:return F=XNt(x,m,k,"musicPlaylist"),f.return(F)}})},F_B=function(){g.wj.apply(this,arguments);
var x=this;this.events=new g.Pr(this);this.x$=this.player.X();this.nN={lf$:function(){return x.S},
Fm:function(){return x.Fm()},
Qc:function(u){return x.Qc(u)}}},f2G=function(x){var u;
x=g.d((u=x.getWatchNextResponse())==null?void 0:u.currentVideoEndpoint,g.x8);if(x==null?0:x.playlistId)var k=x.playlistId;return k},bTo=function(x,u){var k,U,m,F;
return g.Z(function(f){if(f.S==1){k=u.clientPlaybackNonce;U={cpn:k,offlineSourceVisualElement:g.ld(u.ut||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};u.V&&(U.videoFmt=Number(u.V.itag));u.K&&(U.audioFmt=Number(u.K.itag));if((m=f2G(u))&&u.videoId){var V=u.videoId;V=m!=="PPSV"?Promise.resolve(!1):x.S.wP(V);f=g.n(f,V,3)}else f=f.TY(2);return f}f.S!=2&&(F=f.V)&&(U.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");x.V=k;g.RV("offlinePlaybackStarted",U);g.wQ(f)})};
g.Oh.prototype.ww=g.gQ(51,function(x){return this.app.ww(x)});
g.Mn.prototype.ww=g.gQ(50,function(x){return g.QHj(this,9,x)});
g.M(a8,Z3);g.fR.Object.defineProperties(a8.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(x){this.S.entityMetadata=x}}});
g.M(kcS,a8);kcS.prototype.V=function(){return[]};
g.M(UyW,a8);UyW.prototype.V=function(){return[]};
g.M(my9,a8);my9.prototype.V=function(){return[]};
g.M(FPk,a8);FPk.prototype.V=function(){return[]};
g.M(fjS,a8);fjS.prototype.V=function(){var x=[];this.S.alternateChannel&&x.push(this.S.alternateChannel);this.S.alternateChannelList&&x.push.apply(x,g.t(this.S.alternateChannelList));this.S.oneofChannelEntity&&x.push(this.S.oneofChannelEntity);return[].concat(g.t(new Set(x)))};
g.M(bp9,a8);bp9.prototype.V=function(){var x=[];this.S.entryCollection&&x.push(this.S.entryCollection);return[].concat(g.t(new Set(x)))};
g.M(VQk,Z3);VQk.prototype.V=function(){var x=[];this.S.video&&x.push(this.S.video);return[].concat(g.t(new Set(x)))};
g.M(hHm,a8);hHm.prototype.V=function(){var x=[];this.S.parentPlaylist&&x.push(this.S.parentPlaylist);if(this.S.entries)for(var u=g.w(this.S.entries),k=u.next();!k.done;k=u.next())x.push.apply(x,g.t((new VQk(k.value)).V()));return[].concat(g.t(new Set(x)))};
g.M(XLm,a8);XLm.prototype.V=function(){var x=[];this.S.descriptionEntity&&x.push(this.S.descriptionEntity);this.S.creators&&x.push.apply(x,g.t(this.S.creators));this.S.theBiggestFan&&x.push(this.S.theBiggestFan);return[].concat(g.t(new Set(x)))};
g.M(quG,a8);quG.prototype.V=function(){return[]};
g.M(sZZ,a8);sZZ.prototype.V=function(){return[]};
g.M(Hpt,a8);Hpt.prototype.V=function(){return[]};
g.M(RHt,a8);RHt.prototype.V=function(){return[]};
g.M(pLG,a8);pLG.prototype.V=function(){return[]};
g.M(cVs,a8);cVs.prototype.V=function(){return[]};
g.M(MQo,a8);MQo.prototype.V=function(){return[]};
g.M(wLB,a8);wLB.prototype.V=function(){return[]};
g.M(yVm,a8);yVm.prototype.V=function(){return[]};
g.M(YuS,a8);YuS.prototype.V=function(){var x=[];this.S.downloadsList&&x.push(this.S.downloadsList);this.S.smartDownloadsList&&x.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&x.push(this.S.recommendedDownloadsList);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.t(new Set(x)))};
g.M(tQt,Z3);tQt.prototype.V=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.playlist&&x.push(this.S.playlist);this.S.videoItem&&x.push(this.S.videoItem);this.S.playlistItem&&x.push(this.S.playlistItem);return[].concat(g.t(new Set(x)))};
g.M(E5B,a8);E5B.prototype.V=function(){var x=[];this.S.refresh&&x.push(this.S.refresh);if(this.S.downloads)for(var u=g.w(this.S.downloads),k=u.next();!k.done;k=u.next())x.push.apply(x,g.t((new tQt(k.value)).V()));return[].concat(g.t(new Set(x)))};
g.M(Gc$,a8);Gc$.prototype.V=function(){var x=[];this.S.localImageEntities&&x.push.apply(x,g.t(this.S.localImageEntities));return[].concat(g.t(new Set(x)))};
g.M(zHt,a8);zHt.prototype.V=function(){var x=[];this.S.playbackData&&x.push(this.S.playbackData);this.S.localImageEntities&&x.push.apply(x,g.t(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.t(new Set(x)))};
g.M(WP$,a8);WP$.prototype.V=function(){return[]};
g.M(Opt,a8);Opt.prototype.V=function(){var x=[];this.S.fakeChildren&&x.push.apply(x,g.t(this.S.fakeChildren));return[].concat(g.t(new Set(x)))};
g.M(ips,a8);ips.prototype.V=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.playbackData&&x.push(this.S.playbackData);this.S.offlineVideoPolicy&&x.push(this.S.offlineVideoPolicy);return[].concat(g.t(new Set(x)))};
g.M(ljS,a8);ljS.prototype.V=function(){return[]};
g.M(n5G,a8);n5G.prototype.V=function(){var x=[];this.S.channelOwner&&x.push(this.S.channelOwner);this.S.videos&&x.push.apply(x,g.t(this.S.videos));this.S.collaboratorChannels&&x.push.apply(x,g.t(this.S.collaboratorChannels));this.S.downloadState&&x.push(this.S.downloadState);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.t(new Set(x)))};
g.M($ym,a8);$ym.prototype.V=function(){var x=[];this.S.video&&x.push(this.S.video);this.S.channelContributor&&x.push(this.S.channelContributor);return[].concat(g.t(new Set(x)))};
g.M(rVo,Z3);rVo.prototype.V=function(){var x=[];this.S.localImageEntities&&x.push.apply(x,g.t(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.t(new Set(x)))};
g.M(jZG,Z3);jZG.prototype.V=function(){var x=[];this.S.recommendedVideoMetadata&&x.push.apply(x,g.t((new rVo(this.S.recommendedVideoMetadata)).V()));return[].concat(g.t(new Set(x)))};
g.M(Zpm,Z3);Zpm.prototype.V=function(){var x=[];this.S.playbackPosition&&x.push(this.S.playbackPosition);return[].concat(g.t(new Set(x)))};
g.M(aj9,a8);aj9.prototype.V=function(){var x=[];this.S.owner&&x.push(this.S.owner);this.S.downloadState&&x.push(this.S.downloadState);this.S.userState&&x.push.apply(x,g.t((new Zpm(this.S.userState)).V()));this.S.additionalMetadata&&x.push.apply(x,g.t((new jZG(this.S.additionalMetadata)).V()));return[].concat(g.t(new Set(x)))};
g.M(QZS,a8);QZS.prototype.V=function(){var x=[];this.S.userChannelDetails&&x.push(this.S.userChannelDetails);return[].concat(g.t(new Set(x)))};
g.M(Ijt,a8);Ijt.prototype.V=function(){var x=[];this.S.channelOwner&&x.push(this.S.channelOwner);this.S.playbackPosition&&x.push(this.S.playbackPosition);this.S.localImageEntities&&x.push.apply(x,g.t(this.S.localImageEntities));this.S.downloadStatus&&x.push(this.S.downloadStatus);return[].concat(g.t(new Set(x)))};
g.M(eHS,a8);eHS.prototype.V=function(){return[]};
g.M(JVo,a8);JVo.prototype.V=function(){return[]};
g.M(PQs,a8);PQs.prototype.V=function(){return[]};
g.M(NLm,a8);NLm.prototype.V=function(){return[]};
g.M(dyt,a8);dyt.prototype.V=function(){return[]};
g.M(KPo,a8);KPo.prototype.V=function(){return[]};
g.M(v5t,a8);v5t.prototype.V=function(){return[]};
g.M(TLo,a8);TLo.prototype.V=function(){return[]};
g.M(AVW,a8);AVW.prototype.V=function(){return[]};
g.M(CQ$,a8);CQ$.prototype.V=function(){return[]};
g.M(LPk,a8);LPk.prototype.V=function(){return[]};
g.M(Dyt,a8);Dyt.prototype.V=function(){var x=[];this.S.trackDownloadMetadatas&&x.push.apply(x,g.t(this.S.trackDownloadMetadatas));return[].concat(g.t(new Set(x)))};
g.M(SuZ,a8);
SuZ.prototype.V=function(){var x=[];this.S.downloadedTracks&&x.push.apply(x,g.t(this.S.downloadedTracks));this.S.smartDownloadedTracks&&x.push.apply(x,g.t(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&x.push.apply(x,g.t(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&x.push.apply(x,g.t(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&x.push.apply(x,g.t(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&x.push.apply(x,g.t(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
x.push.apply(x,g.t(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&x.push.apply(x,g.t(this.S.metadataOnlyTracks));return[].concat(g.t(new Set(x)))};
g.M(BLk,a8);BLk.prototype.V=function(){var x=[];this.S.trackDownloadMetadatas&&x.push.apply(x,g.t(this.S.trackDownloadMetadatas));return[].concat(g.t(new Set(x)))};
g.M(oL$,a8);oL$.prototype.V=function(){var x=[];this.S.playbackData&&x.push(this.S.playbackData);this.S.localImageEntities&&x.push.apply(x,g.t(this.S.localImageEntities));this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.t(new Set(x)))};
g.M(xxG,a8);xxG.prototype.V=function(){var x=[];this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&x.push.apply(x,g.t(this.S.primaryArtists));this.S.details&&x.push(this.S.details);this.S.userDetails&&x.push(this.S.userDetails);this.S.tracks&&x.push.apply(x,g.t(this.S.tracks));this.S.share&&x.push(this.S.share);this.S.downloadMetadata&&x.push(this.S.downloadMetadata);this.S.refresh&&x.push(this.S.refresh);return[].concat(g.t(new Set(x)))};
g.M(uzZ,a8);uzZ.prototype.V=function(){var x=[];this.S.albumRelease&&x.push(this.S.albumRelease);this.S.tracks&&x.push.apply(x,g.t(this.S.tracks));return[].concat(g.t(new Set(x)))};
g.M(gLk,a8);gLk.prototype.V=function(){var x=[];this.S.albumRelease&&x.push(this.S.albumRelease);return[].concat(g.t(new Set(x)))};
g.M(kio,a8);kio.prototype.V=function(){var x=[];this.S.details&&x.push(this.S.details);this.S.userDetails&&x.push(this.S.userDetails);return[].concat(g.t(new Set(x)))};
g.M(UxG,a8);UxG.prototype.V=function(){var x=[];this.S.parentArtist&&x.push(this.S.parentArtist);return[].concat(g.t(new Set(x)))};
g.M(mxG,a8);mxG.prototype.V=function(){var x=[];this.S.parentArtist&&x.push(this.S.parentArtist);return[].concat(g.t(new Set(x)))};
g.M(FeZ,a8);FeZ.prototype.V=function(){return[]};
g.M(fCo,a8);fCo.prototype.V=function(){return[]};
g.M(blk,Z3);blk.prototype.V=function(){var x=[];this.S.creatorEntity&&x.push(this.S.creatorEntity);return[].concat(g.t(new Set(x)))};
g.M(V0B,a8);
V0B.prototype.V=function(){var x=[];this.S.tracks&&x.push.apply(x,g.t(this.S.tracks));this.S.refresh&&x.push(this.S.refresh);this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.details&&x.push(this.S.details);this.S.downloadMetadata&&x.push(this.S.downloadMetadata);this.S.sideloadMetadata&&x.push(this.S.sideloadMetadata);this.S.userDetails&&x.push(this.S.userDetails);this.S.entryCollection&&x.push(this.S.entryCollection);this.S.share&&x.push(this.S.share);this.S.podcastShowAdditionalMetadata&&x.push.apply(x,
g.t((new blk(this.S.podcastShowAdditionalMetadata)).V()));return[].concat(g.t(new Set(x)))};
g.M(h_Z,a8);h_Z.prototype.V=function(){return[]};
g.M(XUm,a8);
XUm.prototype.V=function(){var x=[];this.S.musicLibraryStatusEntity&&x.push(this.S.musicLibraryStatusEntity);this.S.artists&&x.push.apply(x,g.t(this.S.artists));this.S.audioModeVersion&&x.push(this.S.audioModeVersion);this.S.videoModeVersion&&x.push(this.S.videoModeVersion);this.S.userDetails&&x.push(this.S.userDetails);this.S.details&&x.push(this.S.details);this.S.albumRelease&&x.push(this.S.albumRelease);this.S.share&&x.push(this.S.share);this.S.libraryEdit&&x.push(this.S.libraryEdit);this.S.downloadMetadata&&
x.push(this.S.downloadMetadata);this.S.playbackPosition&&x.push(this.S.playbackPosition);this.S.lyrics&&x.push(this.S.lyrics);return[].concat(g.t(new Set(x)))};
g.M(qet,a8);qet.prototype.V=function(){var x=[];this.S.parentTrack&&x.push(this.S.parentTrack);return[].concat(g.t(new Set(x)))};
g.M(sat,a8);sat.prototype.V=function(){var x=[];this.S.parentTrack&&x.push(this.S.parentTrack);return[].concat(g.t(new Set(x)))};
g.M(Hl$,a8);Hl$.prototype.V=function(){return[]};
g.M(R_9,a8);R_9.prototype.V=function(){return[]};
g.M(pUG,a8);pUG.prototype.V=function(){return[]};
g.M(cIG,a8);cIG.prototype.V=function(){return[]};
g.M(M0G,a8);M0G.prototype.V=function(){var x=[];this.S.transfer&&x.push(this.S.transfer);this.S.adsPlaybackData&&x.push.apply(x,g.t(this.S.adsPlaybackData));this.S.drmLicense&&x.push(this.S.drmLicense);this.S.offlineVideoPolicy&&x.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&x.push(this.S.videoDownloadContextEntity);return[].concat(g.t(new Set(x)))};
g.M(wU9,a8);wU9.prototype.V=function(){return[]};
g.M(yIs,a8);yIs.prototype.V=function(){var x=[];this.S.offlineVideoStreams&&x.push.apply(x,g.t(this.S.offlineVideoStreams));this.S.captionTrack&&x.push.apply(x,g.t(this.S.captionTrack));return[].concat(g.t(new Set(x)))};
g.M(Yet,a8);Yet.prototype.V=function(){return[]};
g.M(t0m,a8);t0m.prototype.V=function(){return[]};
g.M(ELS,a8);ELS.prototype.V=function(){return[]};
g.M(Gi9,a8);Gi9.prototype.V=function(){return[]};
g.M(z_m,a8);z_m.prototype.V=function(){return[]};
g.M(WeG,a8);WeG.prototype.V=function(){return[]};
g.M(Ol9,a8);Ol9.prototype.V=function(){return[]};
g.M(ilt,a8);ilt.prototype.V=function(){return[]};
g.M(lCB,a8);lCB.prototype.V=function(){return[]};
g.M(nLt,a8);nLt.prototype.V=function(){return[]};
g.M($xS,a8);$xS.prototype.V=function(){return[]};
g.M(rIG,a8);rIG.prototype.V=function(){return[]};
g.M(jaG,a8);jaG.prototype.V=function(){return[]};
g.M(Zlt,a8);Zlt.prototype.V=function(){return[]};
g.M(aCG,a8);aCG.prototype.V=function(){return[]};
g.M(QaZ,a8);QaZ.prototype.V=function(){return[]};
g.M(ICS,a8);ICS.prototype.V=function(){return[]};
g.M(e_o,a8);e_o.prototype.V=function(){return[]};
g.M(JIW,a8);JIW.prototype.V=function(){return[]};
var QAB=["browse","music/browse","unplugged/browse"],NOw=["offline/playlist_sync_check"],O4$=["offline"],IDS=["offline/offline_video_playback_position_sync"],Jl$=["offline/get_playback_data_entity"],QE;I8.getInstance=function(){return g.Z(function(x){return x.return(new Promise(function(u){g.UJ().then(function(k){k?(I8.instance||(I8.instance=new I8(k)),u(I8.instance)):u(void 0)})}))})};
I8.prototype.get=function(x){var u=this,k,U,m;return g.Z(function(F){if(F.S==1)return g.n(F,Ke$(u.token),2);if(F.S!=3)return k=F.V,g.n(F,k.get("prefs",x),3);U=F.V;if(!U)return F.return();m=(0,g.j4)();return U.expirationTimestampMs<=m?F.return():F.return(U.value)})};
I8.prototype.set=function(x,u,k){k=k===void 0?31536E3:k;var U=this,m,F,f;return g.Z(function(V){if(V.S==1)return m=(0,g.j4)(),F={key:x,value:u,expirationTimestampMs:m+k*1E3},g.n(V,Ke$(U.token),2);f=V.V;return g.n(V,g.J_(f,"prefs",F),0)})};
I8.prototype.remove=function(x){var u=this,k;return g.Z(function(U){if(U.S==1)return g.n(U,Ke$(u.token),2);k=U.V;return g.n(U,k.delete("prefs",x),0)})};
g.M(eY,g.BG);g.M(J4,LeB);J4.prototype.J=function(x,u){u=SeG(u);x=(new TextEncoder).encode(JSON.stringify(x));return this.S.encrypt(x,u)};
J4.prototype.V=function(x,u){if(!(x instanceof Uint8Array))throw vLm(1);var k=new TextDecoder;u=SeG(u);x=this.S.decrypt(x,u);return JSON.parse(k.decode(x))};
var Bnw={accountLinkStatusEntity:Hpt,booleanEntity:my9,buttonEntity:rIG,captionTrack:Hl$,channelHandle:kcS,commerceAcquisitionClientPayloadEntity:Zlt,commerceCartListEntity:aCG,contextNoteFeedEntityPayload:UyW,continuationTokenEntity:ljS,downloadQualityPickerEntity:MQo,downloadsPageRefreshTokenEntity:yVm,downloadsPageViewConfigurationEntity:eHS,downloadStatusEntity:wLB,dismissState:WeG,sfvAudioItemCurrentlyPlayingEntity:ELS,emojiFountainDataEntity:nLt,emojiCustomizationSetEntity:lCB,fakeChannel:fjS,
fakePlaylist:bp9,fakePlaylistEntryCollection:hHm,fakeVideo:XLm,fakeVideoDescription:quG,featuredProductsEntity:AVW,flowStateEntity:sZZ,iconBadgeEntity:QaZ,interstitialInteractionStateEntity:pLG,likeButtonAnimationEntity:JVo,liveChatPollStateEntity:cVs,liveViewerLeaderboardPointsEntity:t0m,liveReactionsDataEntity:$xS,logoEntity:RHt,macroMarkerEntity:PQs,mainDownloadsLibraryEntity:YuS,mainDownloadsListEntity:E5B,mainPlaylistDownloadStateEntity:Gc$,mainPlaylistEntity:n5G,mainPlaylistVideoEntity:$ym,
mainVideoDownloadStateEntity:zHt,mainVideoEntity:aj9,markersEngagementPanelSyncEntity:NLm,markersVisibilityOverrideEntity:dyt,musicAlbumReleaseDetail:uzZ,musicAlbumReleaseDownloadMetadataEntity:Dyt,musicAlbumRelease:xxG,musicAlbumReleaseUserDetail:gLk,musicArtistDetail:UxG,musicArtist:kio,musicArtistUserDetail:mxG,musicDownloadsLibraryEntity:SuZ,musicLibraryEdit:FeZ,musicLibraryStatusEntity:fCo,musicPlaylist:V0B,musicPlaylistDownloadMetadataEntity:BLk,musicShare:h_Z,musicTrackDetail:qet,musicTrackDownloadMetadataEntity:oL$,
musicTrack:XUm,musicTrackUserDetail:sat,offlineOrchestrationActionWrapperEntity:R_9,offlineVideoPolicy:pUG,offlineVideoStreams:cIG,offlineabilityEntity:WP$,orchestrationWebSamplingEntity:Opt,pageHeaderEntity:Ol9,pdpStateEntity:ICS,pinnedProductEntity:CQ$,playbackData:M0G,playerStateEntity:KPo,quantityIncrementerEntity:e_o,refresh:wU9,saveToPlaylistListEntity:Gi9,settingEntity:z_m,stringEntity:FPk,suggestedFeedbackChipStateEntity:v5t,transfer:yIs,trendingOfferEntity:LPk,videoDownloadContextEntity:Yet,
videoOverviewAsyncDataEntity:JIW,videoPlaybackPositionEntity:jaG,votingEntity:ilt,ytMainChannelEntity:QZS,youchatPendingResponseEntity:TLo,ytMainDownloadedVideoEntity:ips,ytMainVideoEntity:Ijt};g.M(TP,LeB);TP.prototype.J=function(x){return x};
TP.prototype.V=function(x){if(x instanceof Uint8Array)throw vLm(0);return x};
g.M(A4,g.J);A4.prototype.observe=function(x){var u=this;this.observers.push(x);return function(){var k=u.observers.indexOf(x);k>=0&&u.observers.splice(k,1)}};
A4.prototype.V=function(x){q1B(this,x.data)};
A4.prototype.SJ=function(){this.channel.close()};
var cRW,sAG=new g.rf("elementsCommand");var to=new g.rf("entityBatchUpdate");var uuW=new g.rf("downloadStatusEntity");var cWG=new g.rf("mainPlaylistEntityActionMetadata");var C9=new g.rf("mainVideoEntityActionMetadata");var Wno=new g.rf("musicPlaylistEntityActionMetadata");var BlG=new g.rf("musicTrackEntityActionMetadata");var rWm=new g.rf("localImageEntityActionMetadata");var j7=new g.rf("playbackDataActionMetadata");var Hom=new g.rf("transferEntityActionMetadata");var oiZ=new g.rf("videoPlaybackPositionEntityActionMetadata");var rRt;new g.wJ;new g.wJ;Ikw.prototype.request=function(x,u,k){u=u===void 0?{}:u;return this.locks.request(x,u,function(U){return k(U)})};var uv=g.JY.caches,x_,d4S;oH.prototype.open=function(x){return uv.open(PMG(x))};
oH.prototype.has=function(x){return uv.has(PMG(x))};
oH.prototype.delete=function(x){return uv.delete(PMG(x))};
oH.prototype.match=function(x,u){var k=this,U,m,F,f,V,h;return g.Z(function(X){switch(X.S){case 1:return g.n(X,k.keys(),2);case 2:U=X.V,m=g.w(U),F=m.next();case 3:if(F.done){X.TY(5);break}f=F.value;return g.n(X,k.open(f),6);case 6:return V=X.V,g.n(X,V.match(x,u),7);case 7:if(h=X.V)return X.return(h);F=m.next();X.TY(3);break;case 5:return X.return()}})};
g.M(JRG,oH);JRG.prototype.keys=function(){var x,u,k,U,m,F,f,V,h;return g.Z(function(X){if(X.S==1)return x=[],u=g.oV("CacheStorage keys"),g.n(X,uv.keys(),2);k=X.V;U=g.w(k);for(m=U.next();!m.done;m=U.next()){F=m.value;var q=F.indexOf(":");f=q===-1?{O4:F}:{O4:F.substring(0,q),datasyncId:F.substring(q+1)};V=f.O4;h=f.datasyncId;h===u&&x.push(V)}return X.return(x)})};g.M(k_,g.J);k_.prototype.J=function(x){this.api.Xt("onOfflineOperationFailure",x.data)};
k_.prototype.K=function(x){this.api.publish("offlinetransferpause",x.data)};
k_.prototype.SJ=function(){var x;(x=this.S)==null||x.close();var u;(u=this.V)==null||u.close()};T4w.prototype.VQ=function(){this.S&&mK(this)};
T4w.prototype.w4=function(){this.V&&this.V.resolve();this.J=this.S=!1;this.U()};var nim=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var hyt="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var YZG="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.M(Knm,n9);Knm.prototype.V=function(x){return Vn(x)?Alk(this,x):ho(x)?DCS(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.M(SZo,n9);SZo.prototype.V=function(x){return ho(x)?BOs(this,x):xCZ(x)?xPw(this,x):X1(x)?uRs(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.b=gim.prototype;g.b.I3m=function(x){var u=this,k,U,m,F;return g.Z(function(f){if(!g.A(x.state,128))return f.TY(0);k=x.state.Af;var V=(U=k)==null?void 0:U.errorCode,h=(m=k)==null?void 0:m.Oc;F=V==="net.connect"&&h===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(V==null?0:V.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.n(f,u.T9(u.player.getVideoData().videoId,F),0)})};
g.b.T9=function(x,u){var k=this;return g.Z(function(U){if(U.S==1){if(k.V)return U.return();k.V=!0;return u==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Qn(k,x,!1,!0),U.TY(0)):g.n(U,aH(k,x),3)}g.ri(x,4);return g.n(U,k.S.T9(u),0)})};
g.b.Cg=function(x){x.status===2?(x.status!==this.J&&(B0G(this.S),g.ri(x.videoId,2)),x.ma&&kns(this.S,x.videoId,x.ma)):x.status===4?(aH(this,x.videoId),this.T9(x.videoId,x.y6?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):x.status===1&&gyG(this.S);this.J=x.status;this.api.Xt("localmediachange",{videoId:x.videoId,status:x.status})};
g.b.Gr=function(){var x=this,u;return g.Z(function(k){if(k.S==1){if(x.V)return k.return();x.V=!0;u=x.player.getVideoData().videoId;return g.n(k,aH(x,u),2)}return g.n(k,x.S.Gr(),0)})};
g.b.ST=function(x){switch(x){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.b.G=function(x){return this.api.X().G(x)};g.M(V9t,n9);V9t.prototype.V=function(x){return Vn(x)?XBo(this,x):ho(x)?qyG(this,x):xCZ(x)?sTW(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};wBZ.prototype.S=function(x,u){var k=x.action.actionMetadata.priority-u.action.actionMetadata.priority;k===0&&(x.S<u.S?k=-1:x.S>u.S&&(k=1));return k};g.M(IH,g.J);IH.prototype.SJ=function(){this.U&&this.U();g.J.prototype.SJ.call(this)};
IH.prototype.createAction=function(x,u){var k=g.sA(x.entityKey).entityType,U=g.lu(16);return new p9(k,U,x,u.actionId,u.rootActionId)};
IH.prototype.RS=function(x){var u=this,k,U,m,F,f,V,h,X,q;return g.Z(function(H){if(H.S==1){if(u.Ft())return H.return();U=(k=x.offlineOrchestrationActionWrapperEntity)!=null?k:new Set;m=[];F=g.w(U);for(f=F.next();!f.done;f=F.next())V=f.value,h=g.sA(V),X=h.entityId,t9S(u.S,X)||m.push(V);return g.n(H,jTm(u,m),2)}q=H.V;return g.n(H,r5Z(u,q),0)})};
IH.prototype.retry=function(){var x=this;return g.Z(function(u){return g.n(u,ZoS(x),0)})};QTS.prototype.wO=function(x,u){u=u===void 0?!0:u;var k=this,U,m,F,f,V,h,X,q;return g.Z(function(H){switch(H.S){case 1:if(!k.S)return H.return();U=[];m=g.f3(k.S.V,u);F=[];for(f={rj:0};f.rj<m.length;f={rj:f.rj},f.rj++)V=m[f.rj],h=k.S.vc(V,"json3"),X=g.ao(h,{withCredentials:!0,format:"RAW"},3,500).then(function(R){return function(p){p={metadata:g.c5(m[R.rj]),trackData:p.xhr.responseText};F.push(p)}}(f)).sj(function(R){gg("Caption fetch error",R)}),U.push(X);
return g.n(H,g5S(U),2);case 2:return g.YI(H,3),g.n(H,z0t(x,F),5);case 5:g.EY(H,0);break;case 3:q=g.Gx(H),gg("Caption DB transaction error",q),g.wQ(H)}})};g.M(e7,g.J);e7.prototype.SJ=function(){this.V&&this.V();g.J.prototype.SJ.call(this)};
e7.prototype.J=function(x){var u=this,k,U,m,F,f,V,h,X;return g.Z(function(q){U=(k=x.transfer)!=null?k:new Set;m=[];F=g.w(U);for(f=F.next();!f.done;f=F.next())V=f.value,h=g.sA(V),X=h.entityId,m.push(X);return m.length===0?q.return():g.n(q,J5W(u,m),0)})};g.M(vis,g.J);g.b=vis.prototype;g.b.SJ=function(){this.Ok&&this.Ok();this.nm.dispose();this.K.dispose();this.c$&&g.dF(this.j.aX,this.c$);this.gm&&g.dF(this.j.aX,this.gm);g.J.prototype.SJ.call(this)};
g.b.Vg$=function(x){var u=this,k,U,m;return g.Z(function(F){switch(F.S){case 1:k=g.H_(x,"transfer");if(u.S&&k===u.S.key){Qn(u.D,u.N,!0);u.K.stop();F.TY(0);break}return g.n(F,Cs(u.V,{mode:"readwrite",IU:!0},function(f){return Px(f,k,"transfer").then(function(V){if(V&&V.transferState!=="TRANSFER_STATE_COMPLETE"&&V.transferState!=="TRANSFER_STATE_FAILED")return V.transferState="TRANSFER_STATE_PAUSED_BY_USER",Ks(f,V,"transfer").then(function(){return V})})}),3);
case 3:U=F.V;if(!U){F.TY(0);break}if(!x||!u.J){F.TY(5);break}return g.n(F,qR(x,u.J,u.V,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.n(F,NR(u,x),7);case 7:m=F.V,B4B({videoId:x,Jg:U,offlineModeType:m}),g.wQ(F)}})};
g.b.Sit=function(){var x=this;if(this.S&&this.N){Qn(this.D,this.N,!1);var u=this.S,k=(u==null?0:u.key)?g.sA(u.key).entityId:"";k&&this.J&&(new Promise(function(U,m){qR(k,x.J,x.V,"DOWNLOAD_STATE_PAUSED").catch(function(F){m(F)})})).catch(function(U){gg("Download state setting error",U)})}this.K.stop()};
g.b.Ch=function(){this.S?CC9(this,this.S):P6(this)};
g.b.tQ=function(x){var u=this;return g.Z(function(k){switch(k.S){case 1:if(!u.S){k.TY(2);break}if(u.S.transferState==="TRANSFER_STATE_COMPLETE"||u.S.transferState==="TRANSFER_STATE_FAILED"||!x.transfer||!x.transfer.has(u.S.key)){k.TY(3);break}return g.n(k,D3(u.V,u.S.key,"transfer"),4);case 4:u.S=k.V;if(u.S){k.TY(3);break}return g.n(k,LQw(u),3);case 3:if(u.S)return k.return();case 2:return g.n(k,P6(u),0)}})};
g.b.T9=function(x,u){var k=this,U,m,F,f,V;return g.Z(function(h){switch(h.S){case 1:if(!k.S){dg(k,"onTransferFailure: "+x);h.TY(2);break}U=k.S;F=((m=U)==null?0:m.key)?g.sA(U.key).entityId:"";a:switch(x){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var X=!1;break a;default:X=!0}return X&&UNS(k)?g.n(h,K9(k,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.n(h,
mNs(k,x),5);case 5:if(!F||!k.J){h.TY(2);break}return g.n(h,qR(F,k.J,k.V,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.n(h,NR(k,F),9);case 9:f=h.V;f9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:F,Jg:U,offlineModeType:f});if(!F||!k.J){h.TY(2);break}return g.n(h,qR(F,k.J,k.V,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Jo(k),V=P6(k,!0),u&&u(V),g.wQ(h)}})};
g.b.Gr=function(x){var u=this,k,U,m,F,f,V,h,X,q,H,R,p;return g.Z(function(c){switch(c.S){case 1:if(!u.S){dg(u,"onMaybeTransferStreamsExpired");c.TY(2);break}return UNS(u)?g.n(c,K9(u,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.n(c,mNs(u,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!u.J){c.TY(2);break}k=u.S;m=((U=k)==null?0:U.key)?g.sA(k.key).entityId:"";if(!m){c.TY(2);break}return g.n(c,qR(m,u.J,u.V,"DOWNLOAD_STATE_FAILED"),2);case 9:return u.S||dg(u,"onMaybeTransferStreamsExpiredRetryAttempting"),
F=u.S,V=((f=F)==null?0:f.key)?g.sA(F.key).entityId:"",g.n(c,NR(u,V),10);case 10:return h=c.V,f9({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:V,Jg:F,offlineModeType:h}),X=UCm(),g.AQ(X,j7,{isEnqueuedForExpiredStreamUrlRefetch:!0}),q=g.H_(V,"playbackData"),H={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:q,actionMetadata:X},R=MR(new p9("playbackData",V,H)),g.n(c,Ls(u.V,R,"offlineOrchestrationActionWrapperEntity"),2);case 2:Jo(u),p=P6(u,!0),
x&&x(p),g.wQ(c)}})};
var VSS={},FZG=(VSS.TRANSFER_STATE_TRANSFERRING=1,VSS.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,VSS);g.b=v6.prototype;g.b.TD=function(){return this.N.promise};
g.b.fR=function(){if(this.V&&this.D)return this.N.promise;Vq9(this).then(this.N.resolve).catch(this.N.reject);return this.N.promise};
g.b.Ec=function(x){var u={};return u.playbackData=new Knm(x,this.x$,this.S),u.transfer=new V9t(x,this.x$),u.videoPlaybackPositionEntity=new SZo(x,this.x$),u};
g.b.xb=function(){var x=this;return g.Z(function(u){return x.V?g.n(u,T0B(x.V),0):u.TY(0)})};
g.b.X0=function(){var x=this,u,k;return g.Z(function(U){if(U.S==1)return x.V||x.D?g.n(U,x.TD(),2):U.return();x.B!==void 0&&(g.Gm(x.B),x.B=void 0);x.K!==void 0&&(g.Gm(x.K),x.K=void 0);(u=x.V)==null||u.dispose();x.V=void 0;(k=x.D)==null||k.dispose();x.D=void 0;x.api.Xt("onOrchestrationLostLeader");x.N=new g.wJ;g.wQ(U)})};
g.b.isOrchestrationLeader=function(){return this.J.S};
g.b.wP=function(){return g.Z(function(x){return x.return(!1)})};
g.b.eQ=function(x){var u=this.S;u.api.publish("offlinetransferpause",x);var k;(k=u.V)==null||k.postMessage(x)};
g.b.Ch=function(x){var u,k;return g.Z(function(U){if(U.S==1)return g.n(U,Bx(),2);u=U.V;if(!u)return U.return();k=g.H_(x,"transfer");return g.n(U,Cs(u,{mode:"readwrite",IU:!0},function(m){var F=Px(m,k,"transfer"),f=Px(m,g.H_(x,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.l3.all([F,f]).then(function(V){V=g.w(V);var h=V.next().value;var X=V.next().value;return h&&h.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(h.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Ks(m,h,"transfer").then(function(){f9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:x,Jg:h,offlineModeType:X==null?void 0:X.offlineModeType});return g.l3.resolve(null)})):g.l3.resolve(null)})}),0)})};
g.b.ZV=function(x){x=x===void 0?43200:x;var u=this,k,U,m,F,f,V,h,X;return g.Z(function(q){if(q.S==1)return u.j.m2()?g.n(q,Bx(),2):q.return(hXo());if(q.S!=3){k=q.V;if(!k)return q.return([]);U=Date.now()/1E3;return g.n(q,SY(k,"offlineVideoPolicy"),3)}m=q.V;F=[];f=g.w(m);for(V=f.next();!V.done;V=f.next())h=V.value,Number(h.lastUpdatedTimestampSeconds)+x<=U&&(X=g.sA(h.key).entityId,F.push(X));return F.length?q.return(TG(u,F,u.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):q.return([])})};
g.b.deleteAll=function(){return TG(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.b.refreshAllStaleEntities=function(x){var u=this;return g.Z(function(k){return k.S==1?g.n(k,u.ZV(x),2):k.return(k.V)})};
g.b.setUpPositionSyncInterval=function(x){var u=this;this.K!==void 0&&(g.Gm(this.K),this.K=void 0);var k=x!=null?x:864E5;this.K=g.tX(function(){u.mJ(k)},k)};
g.b.mJ=function(x){var u=this,k,U,m,F,f,V;return g.Z(function(h){switch(h.S){case 1:return g.YI(h,2),g.n(h,I8.getInstance(),4);case 4:k=h.V;if(!k)throw Error("prefStorage is undefined");return g.n(h,k.get("psi"),5);case 5:U=h.V;F=((m=U)==null?0:m.aW)?Number(U.aW)/1E3:0;f=Date.now();if(!(F+x<=f)){h.TY(6);break}return g.n(h,TG(u,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.EY(h,0);break;case 2:V=g.Gx(h),gg("Offline manager error",V),
g.wQ(h)}})};
g.b.CT=function(){var x=this,u,k,U,m,F,f,V;return g.Z(function(h){if(h.S==1)return g.n(h,Bx(),2);if(h.S!=3)return(u=h.V)?g.n(h,SY(u,"transfer"),3):h.return([]);k=h.V;U=[];m=g.w(k);for(F=m.next();!F.done;F=m.next())f=F.value,f.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&f.key&&(V=g.sA(f.key).entityId,U.push(V));return h.return(qVk(x,U))})};
g.b.LH=function(){return g.Z(function(x){return x.return([])})};
g.b.LZ=function(){return g.Z(function(x){g.wQ(x)})};
g.b.d6=function(){return g.Z(function(x){g.wQ(x)})};g.M(s0s,n9);s0s.prototype.V=function(x){return Vn(x)?pNm(this,x):ho(x)?Mq9(this,x):X1(x)?wNw(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var Ao=[10];g.M(Gno,n9);Gno.prototype.V=function(x){return Vn(x)?ObG(this,x):ho(x)?ibB(this,x):X1(x)?lls(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var WZ9=[10];g.M($NG,n9);$NG.prototype.V=function(x){return ho(x)?j0Z(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};g.M(ZbS,v6);g.b=ZbS.prototype;g.b.Ec=function(x){var u=v6.prototype.Ec.call(this,x);u.mainVideoEntity=new Gno(x,this.x$,this.S);u.mainPlaylistEntity=new s0s(x,this.x$,this.S);u.mainDownloadsListEntity=new $NG(x,this.x$,this.S);return u};
g.b.refreshAllStaleEntities=function(x,u){var k=this,U,m,F,f,V,h,X,q,H,R,p;return g.Z(function(c){switch(c.S){case 1:U=[];if(!k.x$.G("web_player_offline_playlist_auto_refresh")){c.TY(2);break}return g.n(c,alZ(k,x,u),3);case 3:U=c.V;case 2:return g.n(c,I8.getInstance(),4);case 4:return m=c.V,g.n(c,(F=m)==null?void 0:F.get("sdois"),5);case 5:return f=c.V,g.n(c,(V=m)==null?void 0:V.get("lmqf"),6);case 6:h=c.V;if(!f){c.TY(7);break}q=U;H=q.concat;return g.n(c,Q0m(k,f,(X=h)!=null?X:"SD",x===0),8);case 8:U=
H.call(q,c.V);case 7:return R=U,p=R.concat,g.n(c,v6.prototype.refreshAllStaleEntities.call(k,x,u),9);case 9:return U=p.call(R,c.V),c.return(U)}})};
g.b.wP=function(x){var u,k,U,m,F,f,V,h;return g.Z(function(X){if(X.S==1)return g.n(X,Bx(),2);if(X.S!=3)return(u=X.V)?g.n(X,D3(u,g.Zg,"mainDownloadsListEntity"),3):X.return(!1);k=X.V;if((U=k)==null?0:(m=U.downloads)==null?0:m.length)for(F=g.H_(x,"mainVideoEntity"),f=g.w(k.downloads),V=f.next();!V.done;V=f.next())if(h=V.value,h.videoItem===F)return X.return(!0);return X.return(!1)})};
g.b.LH=function(){var x=this,u,k,U,m,F,f,V,h;return g.Z(function(X){if(X.S==1)return g.n(X,Bx(),2);if(X.S!=3)return(u=X.V)?g.n(X,SY(u,"downloadStatusEntity"),3):X.return([]);k=X.V;U=[];m=g.w(k);for(F=m.next();!F.done;F=m.next())f=F.value,f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&f.key&&(V=g.sA(f.key).entityId,U.push(V));return U.length?(h={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},X.return(TG(x,U,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
h))):X.return([])})};
g.b.d6=function(){var x;return g.Z(function(u){return u.S==1?g.n(u,Bx(),2):(x=u.V)?g.n(u,Cs(x,{mode:"readwrite",IU:!0},function(k){return NZ(k,"mainVideoEntity").then(function(U){var m=[];U=g.w(U);for(var F=U.next();!F.done;F=U.next()){F=F.value;var f=void 0;(f=F.userState)!=null&&f.playbackPosition||(f=g.sA(F.key).entityId,f={key:g.H_(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:"0"},m.push(Ks(k,f,"videoPlaybackPositionEntity")),F.userState={playbackPosition:f.key},m.push(Ks(k,
F,"mainVideoEntity")))}return g.l3.all(m)})}),0):u.return()})};
g.b.LZ=function(){var x,u,k,U,m,F,f,V,h,X,q,H,R,p,c,Y,E,z,O,r,I,N,L,C,kI,Fj,ob,K,B,y,v,P4,Yw,so,OY,SW,mm,pm;return g.Z(function(G){if(G.S==1)return g.n(G,Bx(),2);if(G.S!=3){x=G.V;if(!x)return G.return();u=g.H_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.n(G,Cs(x,{mode:"readonly",IU:!0},function(W){return g.l3.all([Px(W,u,"mainDownloadsListEntity"),Px(W,g.Zg,"mainDownloadsListEntity"),NZ(W,"mainVideoEntity"),NZ(W,"mainPlaylistEntity")])}),3)}k=G.V;
U=g.w(k);m=U.next().value;F=U.next().value;f=U.next().value;V=U.next().value;h=m;X=F;q=f;H=V;R=new Set;if((p=h)==null?0:(c=p.downloads)==null?0:c.length)for(Y=g.w(h.downloads),E=Y.next();!E.done;E=Y.next())z=E.value,O=void 0,(r=(O=z.videoItem)!=null?O:z.playlistItem)&&R.add(r);if((I=X)==null?0:(N=I.downloads)==null?0:N.length)for(L=g.w(X.downloads),C=L.next();!C.done;C=L.next())kI=C.value,kI.videoItem&&R.add(kI.videoItem);Fj=new Set;ob=[];K=g.w(H);for(B=K.next();!B.done;B=K.next()){y=B.value;if(y.videos)for(v=
g.w(y.videos),P4=v.next();!P4.done;P4=v.next())Yw=P4.value,(so=JSON.parse(g.sA(Yw).entityId).videoId)&&Fj.add(so);y.key&&!R.has(y.key)&&ob.push(y.key)}OY=g.w(q);for(SW=OY.next();!SW.done;SW=OY.next())mm=SW.value,mm.key&&!R.has(mm.key)&&(pm=g.sA(mm.key).entityId,Fj.has(pm)||ob.push(mm.key));return ob.length?g.n(G,clG(x,ob),0):G.TY(0)})};g.M(IlG,n9);IlG.prototype.V=function(x){return Vn(x)?JWt(this,x):ho(x)?PBm(this,x):X1(x)?NlS(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var L9=[10];g.M(KZo,n9);KZo.prototype.V=function(x){return Vn(x)?Tlt(this,x):ho(x)?AWS(this,x):X1(x)?CBm(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var DU=[10];g.M(SVG,n9);SVG.prototype.V=function(x){return Vn(x)?uf9(this,x):ho(x)?gVS(this,x):X1(x)?kDt(this,x):Promise.reject(Error("Unsupported action type: "+x.actionType))};
var xrm=[10];g.M(S7,v6);S7.prototype.Ec=function(x){var u=v6.prototype.Ec.call(this,x);u.musicTrack=new SVG(x,this.S);u.musicPlaylist=new KZo(x,this.S);u.musicAlbumRelease=new IlG(x,this.S);return u};
S7.prototype.refreshAllStaleEntities=function(x,u){var k=this,U,m,F;return g.Z(function(f){if(f.S==1)return g.n(f,mrG(k,x,u),2);if(f.S!=3)return m=U=f.V,F=m.concat,g.n(f,v6.prototype.refreshAllStaleEntities.call(k,x,u),3);U=F.call(m,f.V);return f.return(U)})};g.M(F_B,g.wj);g.b=F_B.prototype;g.b.create=function(){var x=this;g.P(this,this.events);g.BC(this.x$)?this.S=new ZbS(this.x$,this.player):g.KD(this.x$)&&(this.S=new S7(this.x$,this.player));this.events.Y(this.player,"onPlaybackStartExternal",function(){x.Fm()});
this.events.Y(this.player,"videodatachange",function(){x.Fm()});
this.x$.G("html5_offline_playback_position_sync")&&this.events.Y(this.player,"presentingplayerstatechange",this.Qc)};
g.b.JK=function(){return!1};
g.b.N_=function(x,u,k,U){var m=this;return g.Z(function(F){return m.S?F.return(TG(m.S,x,u,k,U)):F.return(Promise.reject())})};
g.b.deleteAll=function(){return this.S.deleteAll()};
g.b.ZV=function(x){return this.S.ZV(x)};
g.b.refreshAllStaleEntities=function(x){return this.S.refreshAllStaleEntities(x)};
g.b.setUpPositionSyncInterval=function(x){this.S.setUpPositionSyncInterval(x)};
g.b.eQ=function(x){this.S.eQ(x)};
g.b.Ch=function(x){return this.S.Ch(x)};
g.b.Fm=function(){var x=this,u;return g.Z(function(k){u=x.player.getVideoData();return g.xg(u)?f2G(u)&&x.V!==u.clientPlaybackNonce?g.n(k,bTo(x,u),0):k.TY(0):k.return()})};
g.b.Qc=function(x){var u=this,k,U,m,F,f,V,h;return g.Z(function(X){if(X.S==1)return k=u.player.getVideoData(),U=k.GY,g.YA(x,2)||g.YA(x,512)?g.n(X,Bx(),2):X.return();if(X.S!=3){m=X.V;if(!m)return gg("PES is undefined"),X.return();F=k.videoId;return g.n(X,D3(m,g.H_(F,"mainVideoEntity"),"mainVideoEntity"),3)}f=X.V;if(!f)return X.return();V=Math.floor(U).toString();h={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:V}};return g.n(X,u.N_([F],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
h),0)})};
g.b.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.b.updateDownloadState=function(x,u){var k,U,m,F;return g.Z(function(f){if(f.S==1)return g.n(f,Bx(),2);k=f.V;if(!k)return gg("PES is undefined"),f.return();U=g.sA(x);m=U.entityType;F=U.entityId;return g.n(f,qR(F,m,k,u,!0),0)})};g.M2("offline",F_B);})(_yt_player);
